
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The documentation for the tatva software package">
      
      
      
      
        <link rel="prev" href="../homogenization_periodic/">
      
      
        <link rel="next" href="../soft_hydrogel/">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Cohesive Fracture - tatva</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/custom_css.css">
    
      <link rel="stylesheet" href="../../stylesheets/mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    
      <link rel="stylesheet" href="../../stylesheets/carousel.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#cohesive-fracture" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="tatva" class="md-header__button md-logo" aria-label="tatva" data-md-component="logo">
      
  <img src="../../assets/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tatva
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Cohesive Fracture
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/smec-ethz/tatva" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    smec-ethz/tatva
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="tatva" class="md-nav__button md-logo" aria-label="tatva" data-md-component="logo">
      
  <img src="../../assets/favicon.png" alt="logo">

    </a>
    tatva
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/smec-ethz/tatva" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    smec-ethz/tatva
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Basics of tatva
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Basics of tatva
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sparse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building Stiffness Matrix
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compound/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compound
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lifter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lifter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_elasticity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elasticity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Multi-point Constraints
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Multi-point Constraints
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nonlinear_hole_plate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rigid Body Constraints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contact_3d/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contact Mechanics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../homogenization_periodic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Periodic BCs (Lagrange Multipliers)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" checked>
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mixed-Dimensional Coupling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mixed-Dimensional Coupling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Cohesive Fracture
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Cohesive Fracture
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sec-plate-mode-I" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-crack plate under Mode I loading
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-the-total-potential-energy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining the total potential energy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Defining the total potential energy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-elastic-strain-energy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining elastic strain energy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-total-fracture-energy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining total fracture energy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-the-effective-opening" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining the effective opening
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-the-traction-separation-law" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining the traction-separation law
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boundary-and-loading-condition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Boundary and Loading condition
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-matrix-free-solvers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Matrix-free solvers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visualization
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soft_hydrogel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Embedded 1D Fibres
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Multiphysics Coupling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Multiphysics Coupling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thermal_shock_fracture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thermal-Shock Fracture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advection_diffusion_surface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Non-Variational Formulations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" >
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data-Driven Modeling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data-Driven Modeling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ncm_metamaterial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Constitutive Modeling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../neural_operator_method_3d/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Operator Element Method
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Using External Solvers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Using External Solvers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external_solvers/linear_elasticity_scipy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SciPy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    PETSc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    PETSc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external_solvers/linear_elasticity_petsc4py/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sparse Solver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external_solvers/linear_elasticity_petsc4py_mf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Matrix-Free Solver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.mesh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mesh
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.element/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Element
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.sparse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sparse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.compound/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compound
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.lifter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lifter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#sec-plate-mode-I" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pre-crack plate under Mode I loading
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-the-total-potential-energy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining the total potential energy
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Defining the total potential energy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#defining-elastic-strain-energy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining elastic strain energy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-total-fracture-energy" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining total fracture energy
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-the-effective-opening" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining the effective opening
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#defining-the-traction-separation-law" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining the traction-separation law
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#boundary-and-loading-condition" class="md-nav__link">
    <span class="md-ellipsis">
      
        Boundary and Loading condition
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-matrix-free-solvers" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Matrix-free solvers
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#visualization" class="md-nav__link">
    <span class="md-ellipsis">
      
        Visualization
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Getting Started
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../linear_elasticity/" class="md-path__link">
          
  <span class="md-ellipsis">
    Examples
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="./" class="md-path__link">
          
  <span class="md-ellipsis">
    Mixed-Dimensional Coupling
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  



<p><a href="https://colab.research.google.com/github/smec-ethz/tatva-docs/blob/main/docs/examples/fracture_quasistatic_3d.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<h1 id="cohesive-fracture">Cohesive Fracture<a class="headerlink" href="#cohesive-fracture" title="Permanent link">¤</a></h1>
<details class="example">
<summary>Colab Setup (Install Dependencies)</summary>
<div class="language-python highlight"><pre><span></span><code><span class="c1"># Only run this if we are in Google Colab</span>
<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_ipython</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Installing dependencies from pyproject.toml...&quot;</span><span class="p">)</span>
    <span class="c1"># This installs the repo itself (and its dependencies)</span>
    <span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">gmsh</span> 
    <span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">qq</span> <span class="n">xvfb</span> <span class="n">libgl1</span><span class="o">-</span><span class="n">mesa</span><span class="o">-</span><span class="n">glx</span>
    <span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyvista</span> <span class="o">-</span><span class="n">qq</span>
    <span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="s2">&quot;git+https://github.com/smec-ethz/tatva-docs.git&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>

    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">jupyter_backend</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">notebook</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">start_xvfb</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Installation complete!&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">jupyter_backend</span> <span class="o">=</span> <span class="s1">&#39;client&#39;</span>
</code></pre></div>
</details>
<p>In this notebook, we simulate quasi-static crack propagation along an interface in a 3D plate using Cohesive law. This is an example of mixed-dimensional coupling where the energies are computed in domains which are dimensionally separate. In bulk which is a 3D domain and along the interface which a 2D domain.</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>

<span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># use double-precision</span>
<span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_persistent_cache_min_compile_time_secs&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamedTuple</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">equinox</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">eqx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gmsh</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">meshio</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax</span><span class="w"> </span><span class="kn">import</span> <span class="n">Array</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax_autovmap</span><span class="w"> </span><span class="kn">import</span> <span class="n">autovmap</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tatva</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">Operator</span><span class="p">,</span> <span class="n">element</span>
</code></pre></div>
<p>The critical length for plain strain condition is given by:</p>
<div class="arithmatex">\[L_\text{G} = 2\mu \Gamma/\pi(1-\nu)\sigma_{\infty}^2\]</div>
<p>where <span class="arithmatex">\(\mu\)</span> is the shear modulus, <span class="arithmatex">\(\Gamma\)</span> is the fracture energy, <span class="arithmatex">\(\nu\)</span> is the Poisson's ratio, and <span class="arithmatex">\(\sigma_{\infty}\)</span> is the stress at infinity. For plain strain condition, the effective Young's modulus is given by:</p>
<div class="arithmatex">\[E_\text{eff} = \frac{E}{1-\nu^2}\]</div>
<p>where <span class="arithmatex">\(E\)</span> is the Young's modulus and <span class="arithmatex">\(\nu\)</span> is the Poisson's ratio. For a specimen stretched by a prestrain <span class="arithmatex">\(\epsilon\)</span>, the applied stress at infinity is given by:</p>
<div class="arithmatex">\[\sigma_{\infty} = \epsilon /E_\text{eff}\]</div>
<h2 id="sec-plate-mode-I">Pre-crack plate under Mode I loading<a class="headerlink" href="#sec-plate-mode-I" title="Permanent link">¤</a></h2>
<p>We generate a plate with a pre-crack of length <span class="arithmatex">\(L_G\)</span> and the cohesive interface lies at <span class="arithmatex">\(x \geq L_G\)</span> and <span class="arithmatex">\(y=0\)</span>.</p>
<details class="example">
<summary>View mesh generation functions</summary>
<div class="language-python highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_unstructured_hex_fracture_3d</span><span class="p">(</span>
    <span class="n">length</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">height</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">thickness</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">crack_tip_x</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mesh_size_tip</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">mesh_size_far</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">work_dir</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;../meshes&quot;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates a 3D fracture assembly with an Unstructured HEXAHEDRAL mesh.</span>

<span class="sd">    Args:</span>
<span class="sd">        length: Total length of the block (L)</span>
<span class="sd">        height: Total height of the block (h)</span>
<span class="sd">        thickness: Thickness of the block (t)</span>
<span class="sd">        crack_tip_x: X-coordinate of the crack tip (a)</span>
<span class="sd">        mesh_size_tip: Desired mesh size near the crack tip (refined)</span>
<span class="sd">        mesh_size_far: Desired mesh size far from the crack tip (coarser)</span>
<span class="sd">        work_dir: Directory to store temporary mesh files</span>
<span class="sd">    Returns:</span>
<span class="sd">        mesh: The full 3D mesh of the half-block (Mesh object)</span>
<span class="sd">        interface_mesh: The mesh representing the crack interface (Mesh object)</span>
<span class="sd">        top_interface_nodes: Node indices on the top face of the interface</span>
<span class="sd">        bottom_interface_nodes: Node indices on the bottom face of the interface</span>
<span class="sd">        active_quads_top: Quad element indices on the top face of the interface</span>
<span class="sd">        active_quads_bottom: Quad element indices on the bottom face of the interface</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">work_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">work_dir</span><span class="p">)</span>

    <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">work_dir</span><span class="p">,</span> <span class="s2">&quot;temp_half_block_hex.msh&quot;</span><span class="p">)</span>

    <span class="n">gmsh</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;half_block_hex&quot;</span><span class="p">)</span>

    <span class="n">h_half</span> <span class="o">=</span> <span class="n">height</span> <span class="o">/</span> <span class="mf">2.0</span>

    <span class="c1"># Points: Bottom Face (y=0)</span>
    <span class="n">p1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mesh_size_far</span><span class="p">)</span>
    <span class="n">p4</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">mesh_size_far</span><span class="p">)</span>
    <span class="c1"># x=crack_tip (Refined)</span>
    <span class="n">pt1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">crack_tip_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mesh_size_tip</span><span class="p">)</span>
    <span class="n">pt2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">crack_tip_x</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">mesh_size_tip</span><span class="p">)</span>
    <span class="c1"># x=L</span>
    <span class="n">p2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mesh_size_tip</span><span class="p">)</span>
    <span class="n">p3</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">mesh_size_tip</span><span class="p">)</span>

    <span class="c1"># Points: Top Face (y=h/2)</span>
    <span class="n">p5</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_half</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mesh_size_far</span><span class="p">)</span>
    <span class="n">p8</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">h_half</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">mesh_size_far</span><span class="p">)</span>
    <span class="c1"># x=crack_tip (Refined)</span>
    <span class="n">pt3</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">crack_tip_x</span><span class="p">,</span> <span class="n">h_half</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mesh_size_far</span><span class="p">)</span>
    <span class="n">pt4</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">crack_tip_x</span><span class="p">,</span> <span class="n">h_half</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">mesh_size_far</span><span class="p">)</span>
    <span class="c1"># x=L</span>
    <span class="n">p6</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">h_half</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">mesh_size_far</span><span class="p">)</span>
    <span class="n">p7</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPoint</span><span class="p">(</span><span class="n">length</span><span class="p">,</span> <span class="n">h_half</span><span class="p">,</span> <span class="n">thickness</span><span class="p">,</span> <span class="n">mesh_size_far</span><span class="p">)</span>

    <span class="c1"># Lines: Bottom</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">pt1</span><span class="p">)</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">p2</span><span class="p">)</span>
    <span class="n">l_right_b</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p3</span><span class="p">)</span>
    <span class="n">l3</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span>
    <span class="n">l4</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">p4</span><span class="p">)</span>
    <span class="n">l_left_b</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p4</span><span class="p">,</span> <span class="n">p1</span><span class="p">)</span>
    <span class="n">l_crack_b</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">)</span> <span class="c1"># Crack front</span>

    <span class="c1"># Lines: Top</span>
    <span class="n">l5</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p5</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
    <span class="n">l6</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="n">p6</span><span class="p">)</span>
    <span class="n">l_right_t</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p6</span><span class="p">,</span> <span class="n">p7</span><span class="p">)</span>
    <span class="n">l7</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p7</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
    <span class="n">l8</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt4</span><span class="p">,</span> <span class="n">p8</span><span class="p">)</span>
    <span class="n">l_left_t</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p8</span><span class="p">,</span> <span class="n">p5</span><span class="p">)</span>
    <span class="n">l_crack_t</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt3</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>

    <span class="c1"># Lines: Vertical</span>
    <span class="n">v1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p1</span><span class="p">,</span> <span class="n">p5</span><span class="p">)</span>
    <span class="n">v_tip1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt1</span><span class="p">,</span> <span class="n">pt3</span><span class="p">)</span>
    <span class="n">v2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p2</span><span class="p">,</span> <span class="n">p6</span><span class="p">)</span>
    <span class="n">v3</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p3</span><span class="p">,</span> <span class="n">p7</span><span class="p">)</span>
    <span class="n">v_tip2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">pt2</span><span class="p">,</span> <span class="n">pt4</span><span class="p">)</span>
    <span class="n">v4</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addLine</span><span class="p">(</span><span class="n">p4</span><span class="p">,</span> <span class="n">p8</span><span class="p">)</span>

    <span class="c1"># Surfaces (Pre/Post Crack Split)</span>
    <span class="n">loop_if_1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l1</span><span class="p">,</span> <span class="n">l_crack_b</span><span class="p">,</span> <span class="n">l4</span><span class="p">,</span> <span class="n">l_left_b</span><span class="p">])</span>
    <span class="n">s_if_1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">loop_if_1</span><span class="p">])</span>

    <span class="n">loop_if_2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l2</span><span class="p">,</span> <span class="n">l_right_b</span><span class="p">,</span> <span class="n">l3</span><span class="p">,</span> <span class="o">-</span><span class="n">l_crack_b</span><span class="p">])</span>
    <span class="n">s_if_2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">loop_if_2</span><span class="p">])</span>

    <span class="n">loop_top_1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l5</span><span class="p">,</span> <span class="n">l_crack_t</span><span class="p">,</span> <span class="n">l8</span><span class="p">,</span> <span class="n">l_left_t</span><span class="p">])</span>
    <span class="n">s_top_1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">loop_top_1</span><span class="p">])</span>

    <span class="n">loop_top_2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l6</span><span class="p">,</span> <span class="n">l_right_t</span><span class="p">,</span> <span class="n">l7</span><span class="p">,</span> <span class="o">-</span><span class="n">l_crack_t</span><span class="p">])</span>
    <span class="n">s_top_2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">loop_top_2</span><span class="p">])</span>

    <span class="c1"># Sides</span>
    <span class="n">s_left</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l_left_b</span><span class="p">,</span> <span class="n">v1</span><span class="p">,</span> <span class="o">-</span><span class="n">l_left_t</span><span class="p">,</span> <span class="o">-</span><span class="n">v4</span><span class="p">])])</span>
    <span class="n">s_right</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l_right_b</span><span class="p">,</span> <span class="n">v3</span><span class="p">,</span> <span class="o">-</span><span class="n">l_right_t</span><span class="p">,</span> <span class="o">-</span><span class="n">v2</span><span class="p">])])</span>
    <span class="n">s_front_1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l1</span><span class="p">,</span> <span class="n">v_tip1</span><span class="p">,</span> <span class="o">-</span><span class="n">l5</span><span class="p">,</span> <span class="o">-</span><span class="n">v1</span><span class="p">])])</span>
    <span class="n">s_front_2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l2</span><span class="p">,</span> <span class="n">v2</span><span class="p">,</span> <span class="o">-</span><span class="n">l6</span><span class="p">,</span> <span class="o">-</span><span class="n">v_tip1</span><span class="p">])])</span>
    <span class="n">s_back_1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l4</span><span class="p">,</span> <span class="n">v4</span><span class="p">,</span> <span class="o">-</span><span class="n">l8</span><span class="p">,</span> <span class="o">-</span><span class="n">v_tip2</span><span class="p">])])</span>
    <span class="n">s_back_2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l3</span><span class="p">,</span> <span class="n">v_tip2</span><span class="p">,</span> <span class="o">-</span><span class="n">l7</span><span class="p">,</span> <span class="o">-</span><span class="n">v3</span><span class="p">])])</span>
    <span class="n">s_mid</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addPlaneSurface</span><span class="p">([</span><span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addCurveLoop</span><span class="p">([</span><span class="n">l_crack_b</span><span class="p">,</span> <span class="n">v_tip2</span><span class="p">,</span> <span class="o">-</span><span class="n">l_crack_t</span><span class="p">,</span> <span class="o">-</span><span class="n">v_tip1</span><span class="p">])])</span>

    <span class="c1"># Volumes</span>
    <span class="n">sl1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addSurfaceLoop</span><span class="p">([</span><span class="n">s_if_1</span><span class="p">,</span> <span class="n">s_top_1</span><span class="p">,</span> <span class="n">s_left</span><span class="p">,</span> <span class="n">s_front_1</span><span class="p">,</span> <span class="n">s_back_1</span><span class="p">,</span> <span class="n">s_mid</span><span class="p">])</span>
    <span class="n">vol1</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addVolume</span><span class="p">([</span><span class="n">sl1</span><span class="p">])</span>
    <span class="n">sl2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addSurfaceLoop</span><span class="p">([</span><span class="n">s_if_2</span><span class="p">,</span> <span class="n">s_top_2</span><span class="p">,</span> <span class="n">s_right</span><span class="p">,</span> <span class="n">s_front_2</span><span class="p">,</span> <span class="n">s_back_2</span><span class="p">,</span> <span class="n">s_mid</span><span class="p">])</span>
    <span class="n">vol2</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">addVolume</span><span class="p">([</span><span class="n">sl2</span><span class="p">])</span>

    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">geo</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="p">[</span><span class="n">s_if_1</span><span class="p">,</span> <span class="n">s_if_2</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;interface_surface&quot;</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="n">vol1</span><span class="p">,</span> <span class="n">vol2</span><span class="p">],</span> <span class="mi">2</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;top_domain&quot;</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.SubdivisionAlgorithm&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>

    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

    <span class="n">_m</span> <span class="o">=</span> <span class="n">meshio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="n">points_top</span> <span class="o">=</span> <span class="n">_m</span><span class="o">.</span><span class="n">points</span> <span class="c1"># (N, 3)</span>

    <span class="n">hex_top</span> <span class="o">=</span> <span class="n">_m</span><span class="o">.</span><span class="n">cells_dict</span><span class="p">[</span><span class="s2">&quot;hexahedron&quot;</span><span class="p">]</span>

    <span class="n">interface_surf_idx</span> <span class="o">=</span> <span class="n">_m</span><span class="o">.</span><span class="n">cell_sets_dict</span><span class="p">[</span><span class="s2">&quot;interface_surface&quot;</span><span class="p">][</span><span class="s2">&quot;quad&quot;</span><span class="p">]</span>
    <span class="n">all_interface_quads_top</span> <span class="o">=</span> <span class="n">_m</span><span class="o">.</span><span class="n">cells_dict</span><span class="p">[</span><span class="s2">&quot;quad&quot;</span><span class="p">][</span><span class="n">interface_surf_idx</span><span class="p">]</span>

    <span class="n">points_bottom</span> <span class="o">=</span> <span class="n">points_top</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">points_bottom</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">*=</span> <span class="o">-</span><span class="mi">1</span> <span class="c1"># Flip Y</span>
    <span class="n">points_bottom</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="mf">1e-7</span>

    <span class="n">N_half</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">points_top</span><span class="p">)</span>

    <span class="n">hex_bottom</span> <span class="o">=</span> <span class="n">hex_top</span> <span class="o">+</span> <span class="n">N_half</span>

    <span class="n">hex_bottom</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hex_bottom</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
    <span class="n">hex_bottom</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]]</span> <span class="o">=</span> <span class="n">hex_bottom</span><span class="p">[:,</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">]]</span>

    <span class="n">coords</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">points_top</span><span class="p">,</span> <span class="n">points_bottom</span><span class="p">])</span>
    <span class="n">elements</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">hex_top</span><span class="p">,</span> <span class="n">hex_bottom</span><span class="p">])</span>

    <span class="n">quad_coords</span> <span class="o">=</span> <span class="n">points_top</span><span class="p">[</span><span class="n">all_interface_quads_top</span><span class="p">]</span>
    <span class="n">centroids_x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">quad_coords</span><span class="p">[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">active_mask</span> <span class="o">=</span> <span class="n">centroids_x</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">crack_tip_x</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">)</span>

    <span class="n">active_quads_top</span> <span class="o">=</span> <span class="n">all_interface_quads_top</span><span class="p">[</span><span class="n">active_mask</span><span class="p">]</span>
    <span class="n">active_quads_bottom</span> <span class="o">=</span> <span class="n">active_quads_top</span> <span class="o">+</span> <span class="n">N_half</span>

    <span class="n">unique_nodes_bot</span><span class="p">,</span> <span class="n">inverse_indices</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">active_quads_bottom</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">interface_coords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">unique_nodes_bot</span><span class="p">]</span>
    <span class="n">interface_connectivity</span> <span class="o">=</span> <span class="n">inverse_indices</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">active_quads_bottom</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">interface_mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">interface_coords</span><span class="p">,</span> <span class="n">interface_connectivity</span><span class="p">)</span>

    <span class="n">bottom_interface_nodes</span> <span class="o">=</span> <span class="n">unique_nodes_bot</span>
    <span class="n">top_interface_nodes</span> <span class="o">=</span> <span class="n">bottom_interface_nodes</span> <span class="o">-</span> <span class="n">N_half</span>
    <span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">coords</span><span class="p">,</span> <span class="n">elements</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">mesh</span><span class="p">,</span> <span class="n">interface_mesh</span><span class="p">,</span> <span class="n">top_interface_nodes</span><span class="p">,</span> <span class="n">bottom_interface_nodes</span><span class="p">,</span> <span class="n">active_quads_top</span><span class="p">,</span> <span class="n">active_quads_bottom</span>
</code></pre></div>
</details>
<p>Now, we define the material parameters and geometic parameters.</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">prestrain</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.35</span>

<span class="n">E</span> <span class="o">=</span> <span class="mf">106e3</span>  <span class="c1"># N/m^2</span>
<span class="n">lmbda</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="n">E</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span><span class="p">))</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">E</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">))</span>

<span class="n">Gamma</span> <span class="o">=</span> <span class="mi">15</span>  <span class="c1"># J/m^2</span>
<span class="n">sigma_c</span> <span class="o">=</span> <span class="mf">20e3</span>  <span class="c1"># N/m^2</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mu: </span><span class="si">{</span><span class="n">mu</span><span class="si">}</span><span class="s2"> N/m^2&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;lmbda: </span><span class="si">{</span><span class="n">lmbda</span><span class="si">}</span><span class="s2"> N/m^2&quot;</span><span class="p">)</span>

<span class="n">sigma_inf</span> <span class="o">=</span> <span class="n">prestrain</span> <span class="o">*</span> <span class="n">E</span>

<span class="n">L_G</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">Gamma</span> <span class="o">/</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">nu</span><span class="p">)</span> <span class="o">*</span> <span class="n">sigma_inf</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;L_G: </span><span class="si">{</span><span class="n">L_G</span><span class="si">}</span><span class="s2"> m&quot;</span><span class="p">)</span>
</code></pre></div>
<div class="language-text highlight"><pre><span></span><code>mu: 39259.259259259255 N/m^2
lmbda: 91604.93827160491 N/m^2
L_G: 0.0051332024864342955 m
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="n">Lx</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">L_G</span>
<span class="n">Ly</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">L_G</span>
<span class="n">Lz</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">*</span> <span class="n">L_G</span>

<span class="p">(</span>
    <span class="n">mesh</span><span class="p">,</span>
    <span class="n">interface_mesh</span><span class="p">,</span>
    <span class="n">top_interface_nodes</span><span class="p">,</span>
    <span class="n">bottom_interface_nodes</span><span class="p">,</span>
    <span class="n">top_interface_elements</span><span class="p">,</span>
    <span class="n">bottom_interface_elements</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">generate_unstructured_hex_fracture_3d</span><span class="p">(</span>
    <span class="n">length</span><span class="o">=</span><span class="n">Lx</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="n">Ly</span><span class="p">,</span>
    <span class="n">thickness</span><span class="o">=</span><span class="n">Lz</span><span class="p">,</span>
    <span class="n">crack_tip_x</span><span class="o">=</span><span class="n">crack_length</span><span class="p">,</span>
    <span class="n">mesh_size_tip</span><span class="o">=</span><span class="mf">2e-3</span><span class="p">,</span>
    <span class="n">mesh_size_far</span><span class="o">=</span><span class="mf">4e-3</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">n_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_dofs_per_node</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_dofs</span> <span class="o">=</span> <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">n_nodes</span>
</code></pre></div>
<details class="info">
<summary>Output</summary>
<div class="language-text highlight"><pre><span></span><code>Info    : Meshing 1D...
Info    : [  0%] Meshing curve 1 (Line)
Info    : [ 10%] Meshing curve 2 (Line)
Info    : [ 20%] Meshing curve 3 (Line)
Info    : [ 20%] Meshing curve 4 (Line)
Info    : [ 30%] Meshing curve 5 (Line)
Info    : [ 30%] Meshing curve 6 (Line)
Info    : [ 40%] Meshing curve 7 (Line)
Info    : [ 40%] Meshing curve 8 (Line)
Info    : [ 50%] Meshing curve 9 (Line)
Info    : [ 50%] Meshing curve 10 (Line)
Info    : [ 60%] Meshing curve 11 (Line)
Info    : [ 60%] Meshing curve 12 (Line)
Info    : [ 70%] Meshing curve 13 (Line)
Info    : [ 70%] Meshing curve 14 (Line)
Info    : [ 80%] Meshing curve 15 (Line)
Info    : [ 80%] Meshing curve 16 (Line)
Info    : [ 90%] Meshing curve 17 (Line)
Info    : [ 90%] Meshing curve 18 (Line)
Info    : [100%] Meshing curve 19 (Line)
Info    : [100%] Meshing curve 20 (Line)
Info    : Done meshing 1D (Wall 0.00359308s, CPU 0.004157s)
Info    : Meshing 2D...
Info    : [  0%] Meshing surface 1 (Plane, Frontal-Delaunay)
Info    : [ 10%] Meshing surface 2 (Plane, Frontal-Delaunay)
Info    : [ 20%] Meshing surface 3 (Plane, Frontal-Delaunay)
Info    : [ 30%] Meshing surface 4 (Plane, Frontal-Delaunay)
Info    : [ 40%] Meshing surface 5 (Plane, Frontal-Delaunay)
Info    : [ 50%] Meshing surface 6 (Plane, Frontal-Delaunay)
Info    : [ 60%] Meshing surface 7 (Plane, Frontal-Delaunay)
Info    : [ 70%] Meshing surface 8 (Plane, Frontal-Delaunay)
Info    : [ 80%] Meshing surface 9 (Plane, Frontal-Delaunay)
Info    : [ 90%] Meshing surface 10 (Plane, Frontal-Delaunay)
Info    : [100%] Meshing surface 11 (Plane, Frontal-Delaunay)
Info    : Done meshing 2D (Wall 0.00530414s, CPU 0.004784s)
Info    : Meshing 3D...
Info    : 3D Meshing 2 volumes with 1 connected component
Info    : Tetrahedrizing 249 nodes...
Info    : Done tetrahedrizing 257 nodes (Wall 0.00191356s, CPU 0.002098s)
Info    : Reconstructing mesh...
Info    :  - Creating surface mesh
Info    :  - Identifying boundary edges
Info    :  - Recovering boundary
Info    : Done reconstructing mesh (Wall 0.00425647s, CPU 0.00351s)
Info    : Found volume 1
Info    : Found volume 2
Info    : It. 0 - 0 nodes created - worst tet radius 1.19778 (nodes removed 0 0)
Info    : 3D refinement terminated (255 nodes total):
Info    :  - 0 Delaunay cavities modified for star shapeness
Info    :  - 0 nodes could not be inserted
Info    :  - 680 tetrahedra created in 0.000347617 sec. (1956175 tets/s)
Info    : 0 node relocations
Info    : Done meshing 3D (Wall 0.00848098s, CPU 0.007885s)
Info    : Optimizing mesh...
Info    : Optimizing volume 1
Info    : Optimization starts (volume = 2.43466e-07) with worst = 0.0504542 / average = 0.777641:
Info    : 0.00 &lt; quality &lt; 0.10 :         2 elements
Info    : 0.10 &lt; quality &lt; 0.20 :         0 elements
Info    : 0.20 &lt; quality &lt; 0.30 :         2 elements
Info    : 0.30 &lt; quality &lt; 0.40 :         0 elements
Info    : 0.40 &lt; quality &lt; 0.50 :         3 elements
Info    : 0.50 &lt; quality &lt; 0.60 :         1 elements
Info    : 0.60 &lt; quality &lt; 0.70 :        29 elements
Info    : 0.70 &lt; quality &lt; 0.80 :        43 elements
Info    : 0.80 &lt; quality &lt; 0.90 :        52 elements
Info    : 0.90 &lt; quality &lt; 1.00 :        30 elements
Info    : 4 edge swaps, 0 node relocations (volume = 2.43466e-07): worst = 0.479486 / average = 0.794093 (Wall 6.8234e-05s, CPU 9.5e-05s)
Info    : No ill-shaped tets in the mesh :-)
Info    : 0.00 &lt; quality &lt; 0.10 :         0 elements
Info    : 0.10 &lt; quality &lt; 0.20 :         0 elements
Info    : 0.20 &lt; quality &lt; 0.30 :         0 elements
Info    : 0.30 &lt; quality &lt; 0.40 :         0 elements
Info    : 0.40 &lt; quality &lt; 0.50 :         3 elements
Info    : 0.50 &lt; quality &lt; 0.60 :         1 elements
Info    : 0.60 &lt; quality &lt; 0.70 :        31 elements
Info    : 0.70 &lt; quality &lt; 0.80 :        41 elements
Info    : 0.80 &lt; quality &lt; 0.90 :        50 elements
Info    : 0.90 &lt; quality &lt; 1.00 :        32 elements
Info    : Optimizing volume 2
Info    : Optimization starts (volume = 1.10912e-06) with worst = 0.0625991 / average = 0.673012:
Info    : 0.00 &lt; quality &lt; 0.10 :        10 elements
Info    : 0.10 &lt; quality &lt; 0.20 :         7 elements
Info    : 0.20 &lt; quality &lt; 0.30 :        12 elements
Info    : 0.30 &lt; quality &lt; 0.40 :        16 elements
Info    : 0.40 &lt; quality &lt; 0.50 :        45 elements
Info    : 0.50 &lt; quality &lt; 0.60 :        49 elements
Info    : 0.60 &lt; quality &lt; 0.70 :       148 elements
Info    : 0.70 &lt; quality &lt; 0.80 :        85 elements
Info    : 0.80 &lt; quality &lt; 0.90 :        76 elements
Info    : 0.90 &lt; quality &lt; 1.00 :        70 elements
Info    : 27 edge swaps, 0 node relocations (volume = 1.10912e-06): worst = 0.309952 / average = 0.698742 (Wall 0.000326186s, CPU 0.000311s)
Info    : No ill-shaped tets in the mesh :-)
Info    : 0.00 &lt; quality &lt; 0.10 :         0 elements
Info    : 0.10 &lt; quality &lt; 0.20 :         0 elements
Info    : 0.20 &lt; quality &lt; 0.30 :         0 elements
Info    : 0.30 &lt; quality &lt; 0.40 :        23 elements
Info    : 0.40 &lt; quality &lt; 0.50 :        48 elements
Info    : 0.50 &lt; quality &lt; 0.60 :        50 elements
Info    : 0.60 &lt; quality &lt; 0.70 :       139 elements
Info    : 0.70 &lt; quality &lt; 0.80 :        90 elements
Info    : 0.80 &lt; quality &lt; 0.90 :        77 elements
Info    : 0.90 &lt; quality &lt; 1.00 :        70 elements
Info    : Done optimizing mesh (Wall 0.000840244s, CPU 0.000912s)
Info    : Refining mesh...
Info    : Meshing order 2 (curvilinear on)...
Info    : [  0%] Meshing curve 1 order 2
Info    : [ 10%] Meshing curve 2 order 2
Info    : [ 10%] Meshing curve 3 order 2
Info    : [ 10%] Meshing curve 4 order 2
Info    : [ 20%] Meshing curve 5 order 2
Info    : [ 20%] Meshing curve 6 order 2
Info    : [ 20%] Meshing curve 7 order 2
Info    : [ 30%] Meshing curve 8 order 2
Info    : [ 30%] Meshing curve 9 order 2
Info    : [ 30%] Meshing curve 10 order 2
Info    : [ 40%] Meshing curve 11 order 2
Info    : [ 40%] Meshing curve 12 order 2
Info    : [ 40%] Meshing curve 13 order 2
Info    : [ 40%] Meshing curve 14 order 2
Info    : [ 50%] Meshing curve 15 order 2
Info    : [ 50%] Meshing curve 16 order 2
Info    : [ 50%] Meshing curve 17 order 2
Info    : [ 60%] Meshing curve 18 order 2
Info    : [ 60%] Meshing curve 19 order 2
Info    : [ 60%] Meshing curve 20 order 2
Info    : [ 70%] Meshing surface 1 order 2
Info    : [ 70%] Meshing surface 2 order 2
Info    : [ 70%] Meshing surface 3 order 2
Info    : [ 70%] Meshing surface 4 order 2
Info    : [ 80%] Meshing surface 5 order 2
Info    : [ 80%] Meshing surface 6 order 2
Info    : [ 80%] Meshing surface 7 order 2
Info    : [ 90%] Meshing surface 8 order 2
Info    : [ 90%] Meshing surface 9 order 2
Info    : [ 90%] Meshing surface 10 order 2
Info    : [100%] Meshing surface 11 order 2
Info    : [100%] Meshing volume 1 order 2
Info    : [100%] Meshing volume 2 order 2
Info    : Surface mesh: worst distortion = 1 (0 elements in ]0, 0.2]); worst gamma = 0.702659
Info    : Volume mesh: worst distortion = 1 (0 elements in ]0, 0.2])
Info    : Done meshing order 2 (Wall 0.00286796s, CPU 0.0023s)
Info    : Done refining mesh (Wall 0.00733381s, CPU 0.006798s)
Info    : 3613 nodes 4347 elements
Info    : Writing &#39;../meshes/temp_half_block_hex.msh&#39;...
Info    : Done writing &#39;../meshes/temp_half_block_hex.msh&#39;
</code></pre></div>
</details>
<div class="language-python highlight"><pre><span></span><code><span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">8</span><span class="p">),</span> <span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">HEXAHEDRON</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">grid_interface</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">QUAD</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">pl</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">,</span>  <span class="n">smooth_shading</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">grid_interface</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span>  <span class="n">smooth_shading</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">view_isometric</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><a href="../../assets/plots/fracture_mesh_interactive.html" target="_blank"><img alt="Click to view interactive 3D model" src="../../assets/plots/fracture_mesh_preview.png" /></a></p>
<p><em>Click the image above to mesh in full screen.</em></p>
<p>We can now create the mesh and <code>tatva.Operator</code> to integrate the energy. We define the Element 8-node <code>Hexahedron</code>. One can implement any new H<span class="arithmatex">\(^1\)</span> finite-element.</p>
<details class="example">
<summary>Define the 8-node hexahedral element</summary>
<div class="language-python highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Hexahedron8</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Element</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A 8-node linear hexahedral element.&quot;&quot;&quot;</span>

    <span class="n">a</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>

    <span class="c1"># 2x2x2 Gauss Quadrature Rule</span>
    <span class="n">quad_points</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">],</span>
            <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">],</span>
            <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">],</span>
            <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">],</span>
            <span class="p">[</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">],</span>
        <span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Weights are all 1.0 for this rule (since interval is [-1, 1])</span>
    <span class="n">quad_weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">shape_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the shape functions evaluated at the local coordinates (xi, eta, zeta).&quot;&quot;&quot;</span>
        <span class="n">xi</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">zeta</span> <span class="o">=</span> <span class="n">xi</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
            <span class="p">]</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">shape_function_derivative</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the derivative of the shape functions.&quot;&quot;&quot;</span>
        <span class="c1"># shape (3, 8) -&gt; (dim, n_nodes)</span>
        <span class="n">xi</span><span class="p">,</span> <span class="n">eta</span><span class="p">,</span> <span class="n">zeta</span> <span class="o">=</span> <span class="n">xi</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span><span class="p">)</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="p">[</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">zeta</span><span class="p">),</span>
                <span class="p">],</span>
                <span class="p">[</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">),</span>
                    <span class="o">-</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">eta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">),</span>
                    <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">eta</span><span class="p">),</span>
                <span class="p">],</span>
            <span class="p">]</span>
        <span class="p">)</span>
</code></pre></div>
</details>
<div class="language-python highlight"><pre><span></span><code><span class="nb">hex</span> <span class="o">=</span> <span class="n">Hexahedron8</span><span class="p">()</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="nb">hex</span><span class="p">)</span>
</code></pre></div>
<h2 id="defining-the-total-potential-energy">Defining the total potential energy<a class="headerlink" href="#defining-the-total-potential-energy" title="Permanent link">¤</a></h2>
<h3 id="defining-elastic-strain-energy">Defining elastic strain energy<a class="headerlink" href="#defining-elastic-strain-energy" title="Permanent link">¤</a></h3>
<p>We define a function to compute the linear elastic energy density based on the displacement gradients <span class="arithmatex">\(\nabla u\)</span>.</p>
<div class="arithmatex">\[
\Psi(x) =  \sigma(x) : \epsilon(x)
\]</div>
<p>where <span class="arithmatex">\(\sigma\)</span> is the stress tensor and <span class="arithmatex">\(\epsilon\)</span> is the strain tensor.</p>
<div class="arithmatex">\[
\sigma = \lambda \text{tr}(\epsilon) I + 2\mu \epsilon
\]</div>
<p>and</p>
<div class="arithmatex">\[
\epsilon = \frac{1}{2} (\nabla u + \nabla u^T)
\]</div>
<p>The elastic strain energy density is then given by:</p>
<div class="arithmatex">\[
\Psi_{elastic}(u) = \int_{\Omega} \Psi(x) dV
\]</div>
<div class="language-python highlight"><pre><span></span><code><span class="nd">@autovmap</span><span class="p">(</span><span class="n">grad_u</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_strain</span><span class="p">(</span><span class="n">grad_u</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">grad_u</span> <span class="o">+</span> <span class="n">grad_u</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>


<span class="nd">@autovmap</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lmbda</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_stress</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">eps</span> <span class="o">+</span> <span class="n">lmbda</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">I</span>


<span class="nd">@autovmap</span><span class="p">(</span><span class="n">grad_u</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lmbda</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">strain_energy</span><span class="p">(</span><span class="n">grad_u</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="p">):</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">compute_strain</span><span class="p">(</span><span class="n">grad_u</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">compute_stress</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>


<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">total_strain_energy</span><span class="p">(</span><span class="n">u_flat</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
    <span class="n">u_grad</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">energy_density</span> <span class="o">=</span> <span class="n">strain_energy</span><span class="p">(</span><span class="n">u_grad</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">energy_density</span><span class="p">)</span>
</code></pre></div>
<h3 id="defining-total-fracture-energy">Defining total fracture energy<a class="headerlink" href="#defining-total-fracture-energy" title="Permanent link">¤</a></h3>
<p>The total potential energy <span class="arithmatex">\(\Psi\)</span> is the sum of the elastic strain energy <span class="arithmatex">\(\Psi_{elastic}\)</span> and the cohesive energy <span class="arithmatex">\(\Psi_{cohesive}\)</span>.</p>
<div class="arithmatex">\[\Psi(u)=\Psi_{elastic}(u)+\Psi_{cohesive}(u)\]</div>
<p>The cohesive energy is defined as:</p>
<div class="arithmatex">\[\Psi_{cohesive}(u)= \int_{\Gamma_\text{coh}} \psi(\delta(\boldsymbol{u})) dA\]</div>
<p>where</p>
<ul>
<li><span class="arithmatex">\(\Gamma_{coh}\)</span> is the cohesive interface.</li>
<li><span class="arithmatex">\(\boldsymbol{\delta}(\boldsymbol{u}) = \boldsymbol{u}^+ - \boldsymbol{u}^-\)</span> is the displacement jump across the interface.</li>
<li><span class="arithmatex">\(\phi(\boldsymbol{\delta})\)</span> is the cohesive potential, which defines the energy-separation relationship.</li>
</ul>
<h3 id="defining-the-effective-opening">Defining the effective opening<a class="headerlink" href="#defining-the-effective-opening" title="Permanent link">¤</a></h3>
<p>Now, we proceed with defining the cohesive potential in terms of the jump displacement</p>
<div class="arithmatex">\[
[\![ \boldsymbol{u} ]\!] = \boldsymbol{u}_1 - \boldsymbol{u}_2
\]</div>
<p>where <span class="arithmatex">\(\boldsymbol{u}_1\)</span> and <span class="arithmatex">\(\boldsymbol{u}_2\)</span> are the displacements of the nodes of the upper and lower interface respectively. The effective opening is then given as:</p>
<div class="arithmatex">\[
\delta = \sqrt{[\![ u ]\!]_t^2 + [\![ u_ ]\!]_n^2}
\]</div>
<p>where <span class="arithmatex">\([\![ u ]\!]_t\)</span> and <span class="arithmatex">\([\![ u ]\!]_n\)</span> are the tangential and normal components of the jump displacement with respect to the fracture plane or the interface. Since the fracture plane or the interface is parallel to the <span class="arithmatex">\(x\)</span> axis and we assume that it remains so throughout the simulation, we can then write:</p>
<div class="arithmatex">\[
[\![ u ]\!]_t = [\![ \boldsymbol{u} ]\!]\cdot{}\boldsymbol{e}_x
\]</div>
<p>and</p>
<div class="arithmatex">\[
[\![ u ]\!]_n = [\![ \boldsymbol{u} ]\!]\cdot{}\boldsymbol{e}_y
\]</div>
<p>where <span class="arithmatex">\(\boldsymbol{e}_x\)</span> and <span class="arithmatex">\(\boldsymbol{e}_y\)</span> are the unit vectors in the <span class="arithmatex">\(x\)</span> and <span class="arithmatex">\(y\)</span> directions respectively.</p>
<h3 id="defining-the-traction-separation-law">Defining the traction-separation law<a class="headerlink" href="#defining-the-traction-separation-law" title="Permanent link">¤</a></h3>
<p>For this example, we assume that the cohesive potential is given by the exponential cohesive potential.</p>
<div class="arithmatex">\[
\phi = \Gamma \left(-\frac{\delta}{\delta_c} \exp\left(-\frac{\delta}{\delta_c}\right)\right)
\]</div>
<p>where <span class="arithmatex">\(\Gamma\)</span> is the fracture energy and <span class="arithmatex">\(\delta_c\)</span> is the critical opening. The critical opening for the exponential cohesive potential is given by:</p>
<div class="arithmatex">\[
\delta_c = \frac{\Gamma \exp(-1)}{\sigma_c}
\]</div>
<p>It is the opening at which the cohesive traction is equal to the critical stress.</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">penalty</span> <span class="o">=</span> <span class="mf">1e2</span>
<span class="n">normal_vector</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">])</span>  <span class="c1"># Y-direction</span>
<span class="n">beta</span> <span class="o">=</span> <span class="mf">0.0</span>  <span class="c1"># No tangential contribution</span>

<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">safe_sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>



<span class="nd">@autovmap</span><span class="p">(</span><span class="n">jump</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_opening</span><span class="p">(</span><span class="n">jump</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the opening of the cohesive element.</span>
<span class="sd">    Args:</span>
<span class="sd">        jump: The jump in the displacement field.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The opening of the cohesive element.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">delta_n</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">jump</span><span class="p">,</span> <span class="n">normal_vector</span><span class="p">)</span>
    <span class="n">delta_t_vec</span> <span class="o">=</span> <span class="n">jump</span> <span class="o">-</span> <span class="n">delta_n</span> <span class="o">*</span> <span class="n">normal_vector</span>
    <span class="n">delta_t</span> <span class="o">=</span> <span class="n">safe_sqrt</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">delta_t_vec</span><span class="p">,</span> <span class="n">delta_t_vec</span><span class="p">))</span>
    <span class="n">opening</span> <span class="o">=</span> <span class="n">safe_sqrt</span><span class="p">(</span><span class="n">delta_n</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">beta</span> <span class="o">*</span> <span class="n">delta_t</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">opening</span>



<span class="k">def</span><span class="w"> </span><span class="nf">exponential_potential</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">delta_c</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">Gamma</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">delta</span> <span class="o">/</span> <span class="n">delta_c</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">delta</span> <span class="o">/</span> <span class="n">delta_c</span><span class="p">)))</span>


<span class="n">exponential_traction</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jacrev</span><span class="p">(</span><span class="n">exponential_potential</span><span class="p">)</span>


<span class="nd">@autovmap</span><span class="p">(</span><span class="n">jump</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">delta_max</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">exponential_cohesive_energy</span><span class="p">(</span>
    <span class="n">jump</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
    <span class="n">delta_max</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">Gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">sigma_c</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">penalty</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">delta_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-8</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the cohesive energy for a given jump.</span>
<span class="sd">    Args:</span>
<span class="sd">        jump: The jump in the displacement field.</span>
<span class="sd">        Gamma: Fracture energy of the material.</span>
<span class="sd">        sigma_c: The critical strength of the material.</span>
<span class="sd">        penalty: The penalty parameter for penalizing the interpenetration.</span>
<span class="sd">        delta_threshold: The threshold for the delta parameter.</span>
<span class="sd">    Returns:</span>
<span class="sd">        The cohesive energy.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">compute_opening</span><span class="p">(</span><span class="n">jump</span><span class="p">)</span>
    <span class="n">delta_c</span> <span class="o">=</span> <span class="p">(</span><span class="n">Gamma</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="n">sigma_c</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">true_fun</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">loading</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">exponential_potential</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">delta_c</span><span class="p">)</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">unloading</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
            <span class="n">psi_max</span> <span class="o">=</span> <span class="n">exponential_potential</span><span class="p">(</span><span class="n">delta_max</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">delta_c</span><span class="p">)</span>
            <span class="n">T_max</span> <span class="o">=</span> <span class="n">exponential_traction</span><span class="p">(</span><span class="n">delta_max</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">delta_c</span><span class="p">)</span>
            <span class="n">T_current</span> <span class="o">=</span> <span class="n">T_max</span> <span class="o">*</span> <span class="p">(</span><span class="n">delta</span><span class="p">)</span> <span class="o">/</span> <span class="n">delta_max</span>
            <span class="n">psi_current</span> <span class="o">=</span> <span class="n">psi_max</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_max</span> <span class="o">+</span> <span class="n">T_current</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">delta_max</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">psi_current</span>

        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="n">delta_max</span><span class="p">,</span> <span class="n">loading</span><span class="p">,</span> <span class="n">unloading</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">false_fun</span><span class="p">(</span><span class="n">delta</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">penalty</span> <span class="o">*</span> <span class="n">delta</span><span class="o">**</span><span class="mi">2</span>

    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">delta</span> <span class="o">&gt;</span> <span class="n">delta_threshold</span><span class="p">,</span> <span class="n">true_fun</span><span class="p">,</span> <span class="n">false_fun</span><span class="p">,</span> <span class="n">delta</span><span class="p">)</span>
</code></pre></div>
<p>To ease the integration along the cohesive interface, we will define a new mesh that contains the Quadrilateral elements from one of the two interfaces. Since the two interfaces are discretized using the same number of elements, and occupy the same spatial domain, we can use any one of the two to perform the integration.</p>
<details class="example">
<summary>Define the 4-node quadrilateral element on the interface</summary>
<div class="language-python highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">Quad4Manifold</span><span class="p">(</span><span class="n">element</span><span class="o">.</span><span class="n">Quad4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;A 4-node linear quadrilateral element on a 2D manifold embedded in 3D space.&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">get_jacobian</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">nodal_coords</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="n">Array</span><span class="p">]:</span>
        <span class="n">dNdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_function_derivative</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
        <span class="n">J</span> <span class="o">=</span> <span class="n">dNdr</span> <span class="o">@</span> <span class="n">nodal_coords</span>  <span class="c1"># shape (2, 2) or (2, 3)</span>
        <span class="n">G</span> <span class="o">=</span> <span class="n">J</span> <span class="o">@</span> <span class="n">J</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># shape (2, 2)</span>
        <span class="n">detJ</span> <span class="o">=</span> <span class="n">safe_sqrt</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">G</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">J</span><span class="p">,</span> <span class="n">detJ</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">gradient</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xi</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">nodal_values</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">nodal_coords</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
        <span class="n">dNdr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape_function_derivative</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>  <span class="c1"># shape (2, 3)</span>
        <span class="n">J</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_jacobian</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">nodal_coords</span><span class="p">)</span>  <span class="c1"># shape (2, 3)</span>

        <span class="n">G_inv</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">J</span> <span class="o">@</span> <span class="n">J</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>  <span class="c1"># shape (2, 2)</span>
        <span class="n">J_plus</span> <span class="o">=</span> <span class="n">J</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">G_inv</span>  <span class="c1"># shape (3, 2)</span>

        <span class="n">dudxi</span> <span class="o">=</span> <span class="n">dNdr</span> <span class="o">@</span> <span class="n">nodal_values</span>  <span class="c1"># shape (2, n_values)</span>
        <span class="k">return</span> <span class="n">J_plus</span> <span class="o">@</span> <span class="n">dudxi</span>  <span class="c1"># shape (3, n_values)</span>
</code></pre></div>
</details>
<div class="language-python highlight"><pre><span></span><code><span class="n">quad4</span> <span class="o">=</span> <span class="n">Quad4Manifold</span><span class="p">()</span>
<span class="n">interface_op</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">interface_mesh</span><span class="p">,</span> <span class="n">quad4</span><span class="p">)</span>
</code></pre></div>
<p>Now we can use the <code>interface_op</code> to compute the total cohesive energy along the interface.</p>
<div class="language-python highlight"><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">total_cohesive_energy</span><span class="p">(</span><span class="n">u_flat</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">delta_max</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
    <span class="n">jump</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">top_interface_nodes</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span> <span class="o">-</span> <span class="n">u</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">bottom_interface_nodes</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="n">jump_quad</span> <span class="o">=</span> <span class="n">interface_op</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">jump</span><span class="p">)</span>
    <span class="n">cohesive_energy_density</span> <span class="o">=</span> <span class="n">exponential_cohesive_energy</span><span class="p">(</span>
        <span class="n">jump_quad</span><span class="p">,</span> <span class="n">delta_max</span><span class="p">,</span> <span class="n">Gamma</span><span class="p">,</span> <span class="n">sigma_c</span><span class="p">,</span> <span class="n">penalty</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">interface_op</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">cohesive_energy_density</span><span class="p">)</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">total_energy</span><span class="p">(</span><span class="n">u_flat</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">delta_max</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
    <span class="n">elastic_strain_energy</span> <span class="o">=</span> <span class="n">total_strain_energy</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">cohesive_energy</span> <span class="o">=</span> <span class="n">total_cohesive_energy</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">delta_max</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">elastic_strain_energy</span> <span class="o">+</span> <span class="n">cohesive_energy</span>
</code></pre></div>
<h2 id="boundary-and-loading-condition">Boundary and Loading condition<a class="headerlink" href="#boundary-and-loading-condition" title="Permanent link">¤</a></h2>
<p>We now apply boundary and loading conditions</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">z_max</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">z_min</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">])</span>
<span class="n">y_max</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">y_min</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">x_min</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">y_max</span> <span class="o">-</span> <span class="n">y_min</span>


<span class="n">upper_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_max</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lower_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_min</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">left_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">x_min</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">front_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">z_min</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">back_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">2</span><span class="p">],</span> <span class="n">z_max</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">applied_disp</span> <span class="o">=</span> <span class="mf">2.25</span> <span class="o">*</span> <span class="n">prestrain</span> <span class="o">*</span> <span class="n">height</span>

<span class="n">fixed_dofs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">upper_nodes</span><span class="p">,</span>
        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">upper_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">upper_nodes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>

        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">lower_nodes</span><span class="p">,</span>
        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">lower_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">lower_nodes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>

        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">left_nodes</span><span class="p">,</span>
        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">front_nodes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
        <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">back_nodes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">]</span>
<span class="p">)</span>



<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_dofs</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">upper_nodes</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">prescribed_values</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">upper_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">applied_disp</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">prescribed_values</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">upper_nodes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">prescribed_values</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">lower_nodes</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">prescribed_values</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">lower_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="o">-</span><span class="n">applied_disp</span> <span class="o">/</span> <span class="mf">2.0</span><span class="p">)</span>
<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">prescribed_values</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">lower_nodes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">prescribed_values</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">left_nodes</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">prescribed_values</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">front_nodes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">prescribed_values</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">back_nodes</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>


<span class="n">free_dofs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">setdiff1d</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">n_dofs</span><span class="p">),</span> <span class="n">fixed_dofs</span><span class="p">)</span>
</code></pre></div>
<h2 id="using-matrix-free-solvers">Using Matrix-free solvers<a class="headerlink" href="#using-matrix-free-solvers" title="Permanent link">¤</a></h2>
<p>In this example, we use matrix-free solver. To enforce boundary conditions, we use Projected Conjugate Gradient </p>
<div class="language-python highlight"><pre><span></span><code><span class="c1"># creating functions to compute the gradient and</span>
<span class="n">gradient</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jacrev</span><span class="p">(</span><span class="n">total_energy</span><span class="p">)</span>


<span class="c1"># create a function to compute the JVP product</span>
<span class="nd">@eqx</span><span class="o">.</span><span class="n">filter_jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_tangent</span><span class="p">(</span><span class="n">du</span><span class="p">,</span> <span class="n">u_prev</span><span class="p">,</span> <span class="n">gradient</span><span class="p">):</span>
    <span class="n">du_projected</span> <span class="o">=</span> <span class="n">du</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">tangent</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jvp</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="p">(</span><span class="n">u_prev</span><span class="p">,),</span> <span class="p">(</span><span class="n">du_projected</span><span class="p">,))[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">tangent</span> <span class="o">=</span> <span class="n">tangent</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tangent</span>
</code></pre></div>
<details class="example">
<summary>Define the Netwon-Krylov solvers (Newton and Conjugate Gradient)</summary>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>


<span class="nd">@eqx</span><span class="o">.</span><span class="n">filter_jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">conjugate_gradient</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">iiter</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">body_fun</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rsold</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">iiter</span> <span class="o">=</span> <span class="n">state</span>
        <span class="n">Ap</span> <span class="o">=</span> <span class="n">A</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">rsold</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">Ap</span><span class="p">)</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span> <span class="n">Ap</span><span class="p">)</span>
        <span class="n">rsnew</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">r</span><span class="p">)</span>
        <span class="n">p</span> <span class="o">=</span> <span class="n">r</span> <span class="o">+</span> <span class="p">(</span><span class="n">rsnew</span> <span class="o">/</span> <span class="n">rsold</span><span class="p">)</span> <span class="o">*</span> <span class="n">p</span>
        <span class="n">rsold</span> <span class="o">=</span> <span class="n">rsnew</span>
        <span class="n">iiter</span> <span class="o">=</span> <span class="n">iiter</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rsold</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">iiter</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cond_fun</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
        <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rsold</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">iiter</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">rsold</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">atol</span><span class="p">,</span> <span class="n">iiter</span> <span class="o">&lt;</span> <span class="n">max_iter</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">b</span> <span class="o">-</span> <span class="n">A</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">r</span>
    <span class="n">rsold</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">vdot</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

    <span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rsold</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">iiter</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span>
        <span class="n">cond_fun</span><span class="p">,</span> <span class="n">body_fun</span><span class="p">,</span> <span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">rsold</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">iiter</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">iiter</span>



<span class="nd">@eqx</span><span class="o">.</span><span class="n">filter_jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">newton_krylov_solver</span><span class="p">(</span>
    <span class="n">u_init</span><span class="p">,</span>
    <span class="n">fext</span><span class="p">,</span>
    <span class="n">gradient</span><span class="p">,</span>
    <span class="n">compute_tangent</span><span class="p">,</span>
    <span class="n">fixed_dofs</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">fint_init</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">u_init</span><span class="p">)</span>
    <span class="n">res_init</span> <span class="o">=</span> <span class="p">(</span><span class="n">fext</span> <span class="o">-</span> <span class="n">fint_init</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">norm_res_init</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">res_init</span><span class="p">)</span>

    <span class="n">init_val</span> <span class="o">=</span> <span class="p">(</span><span class="n">u_init</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">norm_res_init</span><span class="p">,</span> <span class="n">fint_init</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">cond_fun</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">iiter</span><span class="p">,</span> <span class="n">norm_res</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">state</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">norm_res</span> <span class="o">&gt;</span> <span class="mf">1e-8</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">iiter</span> <span class="o">&lt;</span> <span class="mi">200</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">body_fun</span><span class="p">(</span><span class="n">state</span><span class="p">):</span>
        <span class="n">u</span><span class="p">,</span> <span class="n">iiter</span><span class="p">,</span> <span class="n">norm_res</span><span class="p">,</span> <span class="n">fint</span> <span class="o">=</span> <span class="n">state</span>

        <span class="n">residual</span> <span class="o">=</span> <span class="p">(</span><span class="n">fext</span> <span class="o">-</span> <span class="n">fint</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>        
        <span class="n">A</span> <span class="o">=</span> <span class="n">eqx</span><span class="o">.</span><span class="n">Partial</span><span class="p">(</span><span class="n">compute_tangent</span><span class="p">,</span> <span class="n">u_prev</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">gradient</span><span class="o">=</span><span class="n">gradient</span><span class="p">)</span>

        <span class="n">du</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">conjugate_gradient</span><span class="p">(</span><span class="n">A</span><span class="o">=</span><span class="n">A</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">residual</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">,</span> <span class="n">max_iter</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

        <span class="n">u_next</span> <span class="o">=</span> <span class="n">u</span> <span class="o">+</span> <span class="n">du</span>

        <span class="n">fint_next</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">u_next</span><span class="p">)</span>
        <span class="n">residual_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">fext</span> <span class="o">-</span> <span class="n">fint_next</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">norm_res_next</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">residual_next</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">u_next</span><span class="p">,</span> <span class="n">iiter</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">norm_res_next</span><span class="p">,</span> <span class="n">fint_next</span><span class="p">)</span>

    <span class="n">final_u</span><span class="p">,</span> <span class="n">final_iiter</span><span class="p">,</span> <span class="n">final_norm</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">while_loop</span><span class="p">(</span><span class="n">cond_fun</span><span class="p">,</span> <span class="n">body_fun</span><span class="p">,</span> <span class="n">init_val</span><span class="p">)</span>
    <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;  Residual: </span><span class="si">{res:.2e}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">final_norm</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">final_u</span><span class="p">,</span> <span class="n">final_norm</span>
</code></pre></div>
</details>
<p>We define the initial conditions.</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">u_prev</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_dofs</span><span class="p">)</span>
<span class="n">fext</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_dofs</span><span class="p">)</span>

<span class="n">jump</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">top_interface_nodes</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="o">-</span> <span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">bottom_interface_nodes</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="p">)</span>
<span class="n">jump_quad</span> <span class="o">=</span> <span class="n">interface_op</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">jump</span><span class="p">)</span>
<span class="n">delta_maxs_prev</span> <span class="o">=</span> <span class="n">compute_opening</span><span class="p">(</span><span class="n">jump_quad</span><span class="p">)</span>
</code></pre></div>
<p>We divided the total loading into <code>300</code> steps. </p>
<div class="language-python highlight"><pre><span></span><code><span class="n">force_on_top</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">displacement_on_top</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">u_per_step</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">energies</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">energies</span><span class="p">[</span><span class="s2">&quot;elastic&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">energies</span><span class="p">[</span><span class="s2">&quot;cohesive&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">delta_maxs_per_step</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">force_on_top</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">displacement_on_top</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">u_per_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">))</span>
<span class="n">energies</span><span class="p">[</span><span class="s2">&quot;elastic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">total_strain_energy</span><span class="p">(</span><span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">))</span>
<span class="p">)</span>
<span class="n">energies</span><span class="p">[</span><span class="s2">&quot;cohesive&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
    <span class="n">total_cohesive_energy</span><span class="p">(</span><span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">),</span> <span class="n">delta_maxs_prev</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">du_total</span> <span class="o">=</span> <span class="n">prescribed_values</span> <span class="o">/</span> <span class="n">n_steps</span>  <span class="c1"># displacement increment</span>

<span class="n">error_per_step</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">step</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Step </span><span class="si">{</span><span class="n">step</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_steps</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">step</span> <span class="o">&lt;</span> <span class="n">n_steps</span><span class="p">:</span>
        <span class="n">u_prev</span> <span class="o">=</span> <span class="n">u_prev</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">du_total</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">])</span>

    <span class="n">gradient_partial</span> <span class="o">=</span> <span class="n">eqx</span><span class="o">.</span><span class="n">Partial</span><span class="p">(</span><span class="n">gradient</span><span class="p">,</span> <span class="n">delta_max</span><span class="o">=</span><span class="n">delta_maxs_prev</span><span class="p">)</span>

    <span class="n">u_new</span><span class="p">,</span> <span class="n">rnorm</span> <span class="o">=</span> <span class="n">newton_krylov_solver</span><span class="p">(</span>
        <span class="n">u_prev</span><span class="p">,</span>
        <span class="n">fext</span><span class="p">,</span>
        <span class="n">gradient_partial</span><span class="p">,</span>
        <span class="n">compute_tangent</span><span class="p">,</span>
        <span class="n">fixed_dofs</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">u_prev</span> <span class="o">=</span> <span class="n">u_new</span>

    <span class="n">force_on_top</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">gradient</span><span class="p">(</span><span class="n">u_prev</span><span class="p">,</span> <span class="n">delta_maxs_prev</span><span class="p">)[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">upper_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="n">displacement_on_top</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">u_prev</span><span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">upper_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]))</span>
    <span class="n">u_per_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">))</span>
    <span class="n">energies</span><span class="p">[</span><span class="s2">&quot;elastic&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">total_strain_energy</span><span class="p">(</span><span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">))</span>
    <span class="p">)</span>
    <span class="n">energies</span><span class="p">[</span><span class="s2">&quot;cohesive&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">total_cohesive_energy</span><span class="p">(</span><span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">),</span> <span class="n">delta_maxs_prev</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">error_per_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rnorm</span><span class="p">)</span>

    <span class="n">jump</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">u_per_step</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">top_interface_nodes</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
            <span class="o">-</span> <span class="n">u_per_step</span><span class="p">[</span><span class="n">step</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">bottom_interface_nodes</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">jump_quad</span> <span class="o">=</span> <span class="n">interface_op</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">jump</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">openings</span> <span class="o">=</span> <span class="n">compute_opening</span><span class="p">(</span><span class="n">jump_quad</span><span class="p">)</span>
    <span class="n">delta_maxs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">delta_maxs_prev</span><span class="p">,</span> <span class="n">openings</span><span class="p">)</span>
    <span class="n">delta_maxs_per_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">delta_maxs</span><span class="p">)</span>

<span class="n">u_solution</span> <span class="o">=</span> <span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
</code></pre></div>
<details class="info">
<summary>Output</summary>
<div class="language-text highlight"><pre><span></span><code>Step 1/300
  Residual: 9.78e-09
Step 2/300
  Residual: 9.59e-09
Step 3/300
  Residual: 9.91e-09
Step 4/300
  Residual: 9.74e-09
Step 5/300
  Residual: 9.75e-09
Step 6/300
  Residual: 9.91e-09
Step 7/300
  Residual: 9.90e-09
Step 8/300
  Residual: 9.91e-09
Step 9/300
  Residual: 9.81e-09
Step 10/300
  Residual: 9.56e-09
Step 11/300
  Residual: 9.94e-09
Step 12/300
  Residual: 9.29e-09
Step 13/300
  Residual: 9.83e-09
Step 14/300
  Residual: 9.66e-09
Step 15/300
  Residual: 9.11e-09
Step 16/300
  Residual: 9.65e-09
Step 17/300
  Residual: 9.57e-09
Step 18/300
  Residual: 9.71e-09
Step 19/300
  Residual: 9.98e-09
Step 20/300
  Residual: 9.70e-09
Step 21/300
  Residual: 9.34e-09
Step 22/300
  Residual: 9.60e-09
Step 23/300
  Residual: 9.83e-09
Step 24/300
  Residual: 9.82e-09
Step 25/300
  Residual: 9.53e-09
Step 26/300
  Residual: 9.92e-09
Step 27/300
  Residual: 9.90e-09
Step 28/300
  Residual: 9.95e-09
Step 29/300
  Residual: 9.34e-09
Step 30/300
  Residual: 9.46e-09
Step 31/300
  Residual: 9.24e-09
Step 32/300
  Residual: 9.67e-09
Step 33/300
  Residual: 9.53e-09
Step 34/300
  Residual: 9.81e-09
Step 35/300
  Residual: 9.61e-09
Step 36/300
  Residual: 9.48e-09
Step 37/300
  Residual: 9.97e-09
Step 38/300
  Residual: 9.09e-09
Step 39/300
  Residual: 9.64e-09
Step 40/300
  Residual: 9.93e-09
Step 41/300
  Residual: 9.84e-09
Step 42/300
  Residual: 9.81e-09
Step 43/300
  Residual: 9.43e-09
Step 44/300
  Residual: 9.78e-09
Step 45/300
  Residual: 9.64e-09
Step 46/300
  Residual: 9.82e-09
Step 47/300
  Residual: 9.87e-09
Step 48/300
  Residual: 9.77e-09
Step 49/300
  Residual: 9.76e-09
Step 50/300
  Residual: 9.72e-09
Step 51/300
  Residual: 9.03e-09
Step 52/300
  Residual: 9.70e-09
Step 53/300
  Residual: 9.58e-09
Step 54/300
  Residual: 9.44e-09
Step 55/300
  Residual: 9.97e-09
Step 56/300
  Residual: 9.84e-09
Step 57/300
  Residual: 9.99e-09
Step 58/300
  Residual: 9.74e-09
Step 59/300
  Residual: 9.60e-09
Step 60/300
  Residual: 9.77e-09
Step 61/300
  Residual: 9.49e-09
Step 62/300
  Residual: 9.81e-09
Step 63/300
  Residual: 9.99e-09
Step 64/300
  Residual: 9.35e-09
Step 65/300
  Residual: 9.92e-09
Step 66/300
  Residual: 9.97e-09
Step 67/300
  Residual: 9.40e-09
Step 68/300
  Residual: 9.61e-09
Step 69/300
  Residual: 9.78e-09
Step 70/300
  Residual: 9.64e-09
Step 71/300
  Residual: 9.55e-09
Step 72/300
  Residual: 9.92e-09
Step 73/300
  Residual: 9.93e-09
Step 74/300
  Residual: 9.90e-09
Step 75/300
  Residual: 9.58e-09
Step 76/300
  Residual: 9.97e-09
Step 77/300
  Residual: 9.97e-09
Step 78/300
  Residual: 9.83e-09
Step 79/300
  Residual: 9.30e-09
Step 80/300
  Residual: 9.97e-09
Step 81/300
  Residual: 9.12e-09
Step 82/300
  Residual: 9.76e-09
Step 83/300
  Residual: 9.66e-09
Step 84/300
  Residual: 9.86e-09
Step 85/300
  Residual: 9.82e-09
Step 86/300
  Residual: 9.81e-09
Step 87/300
  Residual: 9.88e-09
Step 88/300
  Residual: 9.37e-09
Step 89/300
  Residual: 9.83e-09
Step 90/300
  Residual: 9.86e-09
Step 91/300
  Residual: 9.60e-09
Step 92/300
  Residual: 9.80e-09
Step 93/300
  Residual: 9.71e-09
Step 94/300
  Residual: 9.93e-09
Step 95/300
  Residual: 9.83e-09
Step 96/300
  Residual: 9.87e-09
Step 97/300
  Residual: 9.99e-09
Step 98/300
  Residual: 9.61e-09
Step 99/300
  Residual: 9.85e-09
Step 100/300
  Residual: 9.65e-09
Step 101/300
  Residual: 9.71e-09
Step 102/300
  Residual: 9.75e-09
Step 103/300
  Residual: 9.89e-09
Step 104/300
  Residual: 9.63e-09
Step 105/300
  Residual: 9.96e-09
Step 106/300
  Residual: 9.97e-09
Step 107/300
  Residual: 9.71e-09
Step 108/300
  Residual: 9.83e-09
Step 109/300
  Residual: 9.92e-09
Step 110/300
  Residual: 9.27e-09
Step 111/300
  Residual: 9.27e-09
Step 112/300
  Residual: 9.13e-09
Step 113/300
  Residual: 9.53e-09
Step 114/300
  Residual: 9.78e-09
Step 115/300
  Residual: 9.77e-09
Step 116/300
  Residual: 9.67e-09
Step 117/300
  Residual: 9.33e-09
Step 118/300
  Residual: 9.61e-09
Step 119/300
  Residual: 9.69e-09
Step 120/300
  Residual: 9.35e-09
Step 121/300
  Residual: 9.39e-09
Step 122/300
  Residual: 9.30e-09
Step 123/300
  Residual: 9.34e-09
Step 124/300
  Residual: 9.21e-09
Step 125/300
  Residual: 9.68e-09
Step 126/300
  Residual: 9.69e-09
Step 127/300
  Residual: 9.55e-09
Step 128/300
  Residual: 9.60e-09
Step 129/300
  Residual: 9.93e-09
Step 130/300
  Residual: 9.42e-09
Step 131/300
  Residual: 9.41e-09
Step 132/300
  Residual: 9.79e-09
Step 133/300
  Residual: 9.89e-09
Step 134/300
  Residual: 9.95e-09
Step 135/300
  Residual: 9.44e-09
Step 136/300
  Residual: 9.66e-09
Step 137/300
  Residual: 9.49e-09
Step 138/300
  Residual: 9.83e-09
Step 139/300
  Residual: 9.96e-09
Step 140/300
  Residual: 9.49e-09
Step 141/300
  Residual: 9.43e-09
Step 142/300
  Residual: 9.94e-09
Step 143/300
  Residual: 9.49e-09
Step 144/300
  Residual: 9.86e-09
Step 145/300
  Residual: 9.11e-09
Step 146/300
  Residual: 9.81e-09
Step 147/300
  Residual: 9.91e-09
Step 148/300
  Residual: 9.87e-09
Step 149/300
  Residual: 9.63e-09
Step 150/300
  Residual: 9.98e-09
Step 151/300
  Residual: 9.25e-09
Step 152/300
  Residual: 9.93e-09
Step 153/300
  Residual: 9.92e-09
Step 154/300
  Residual: 9.58e-09
Step 155/300
  Residual: 9.92e-09
Step 156/300
  Residual: 9.97e-09
Step 157/300
  Residual: 9.99e-09
Step 158/300
  Residual: 9.24e-09
Step 159/300
  Residual: 9.88e-09
Step 160/300
  Residual: 9.14e-09
Step 161/300
  Residual: 9.76e-09
Step 162/300
  Residual: 9.90e-09
Step 163/300
  Residual: 9.99e-09
Step 164/300
  Residual: 9.72e-09
Step 165/300
  Residual: 9.63e-09
Step 166/300
  Residual: 9.90e-09
Step 167/300
  Residual: 9.56e-09
Step 168/300
  Residual: 1.00e-08
Step 169/300
  Residual: 9.41e-09
Step 170/300
  Residual: 8.96e-09
Step 171/300
  Residual: 9.56e-09
Step 172/300
  Residual: 9.13e-09
Step 173/300
  Residual: 9.93e-09
Step 174/300
  Residual: 9.13e-09
Step 175/300
  Residual: 9.54e-09
Step 176/300
  Residual: 9.11e-09
Step 177/300
  Residual: 9.68e-09
Step 178/300
  Residual: 8.50e-09
Step 179/300
  Residual: 9.01e-09
Step 180/300
  Residual: 9.96e-09
Step 181/300
  Residual: 9.86e-09
Step 182/300
  Residual: 9.98e-09
Step 183/300
  Residual: 9.94e-09
Step 184/300
  Residual: 9.72e-09
Step 185/300
  Residual: 9.36e-09
Step 186/300
  Residual: 9.96e-09
Step 187/300
  Residual: 9.93e-09
Step 188/300
  Residual: 9.59e-09
Step 189/300
  Residual: 9.70e-09
Step 190/300
  Residual: 9.69e-09
Step 191/300
  Residual: 9.75e-09
Step 192/300
  Residual: 9.03e-09
Step 193/300
  Residual: 9.77e-09
Step 194/300
  Residual: 9.83e-09
Step 195/300
  Residual: 9.95e-09
Step 196/300
  Residual: 9.74e-09
Step 197/300
  Residual: 9.18e-09
Step 198/300
  Residual: 9.31e-09
Step 199/300
  Residual: 9.64e-09
Step 200/300
  Residual: 9.54e-09
Step 201/300
  Residual: 9.47e-09
Step 202/300
  Residual: 9.50e-09
Step 203/300
  Residual: 9.76e-09
Step 204/300
  Residual: 9.87e-09
Step 205/300
  Residual: 9.43e-09
Step 206/300
  Residual: 9.36e-09
Step 207/300
  Residual: 9.55e-09
Step 208/300
  Residual: 9.97e-09
Step 209/300
  Residual: 9.79e-09
Step 210/300
  Residual: 9.21e-09
Step 211/300
  Residual: 9.74e-09
Step 212/300
  Residual: 9.65e-09
Step 213/300
  Residual: 9.19e-09
Step 214/300
  Residual: 9.85e-09
Step 215/300
  Residual: 9.85e-09
Step 216/300
  Residual: 9.95e-09
Step 217/300
  Residual: 9.86e-09
Step 218/300
  Residual: 9.82e-09
Step 219/300
  Residual: 9.80e-09
Step 220/300
  Residual: 9.73e-09
Step 221/300
  Residual: 9.86e-09
Step 222/300
  Residual: 9.53e-09
Step 223/300
  Residual: 9.85e-09
Step 224/300
  Residual: 9.64e-09
Step 225/300
  Residual: 1.00e-08
Step 226/300
  Residual: 9.91e-09
Step 227/300
  Residual: 9.93e-09
Step 228/300
  Residual: 9.90e-09
Step 229/300
  Residual: 9.90e-09
Step 230/300
  Residual: 9.76e-09
Step 231/300
  Residual: 9.55e-09
Step 232/300
  Residual: 9.41e-09
Step 233/300
  Residual: 9.78e-09
Step 234/300
  Residual: 9.64e-09
Step 235/300
  Residual: 9.90e-09
Step 236/300
  Residual: 9.86e-09
Step 237/300
  Residual: 9.94e-09
Step 238/300
  Residual: 9.93e-09
Step 239/300
  Residual: 9.89e-09
Step 240/300
  Residual: 9.96e-09
Step 241/300
  Residual: 9.90e-09
Step 242/300
  Residual: 9.84e-09
Step 243/300
  Residual: 9.98e-09
Step 244/300
  Residual: 9.87e-09
Step 245/300
  Residual: 9.99e-09
Step 246/300
  Residual: 9.53e-09
Step 247/300
  Residual: 9.52e-09
Step 248/300
  Residual: 9.84e-09
Step 249/300
  Residual: 9.81e-09
Step 250/300
  Residual: 9.37e-09
Step 251/300
  Residual: 9.19e-09
Step 252/300
  Residual: 9.15e-09
Step 253/300
  Residual: 8.69e-09
Step 254/300
  Residual: 8.68e-09
Step 255/300
  Residual: 8.46e-09
Step 256/300
  Residual: 9.97e-09
Step 257/300
  Residual: 9.93e-09
Step 258/300
  Residual: 9.93e-09
Step 259/300
  Residual: 9.85e-09
Step 260/300
  Residual: 9.59e-09
Step 261/300
  Residual: 9.73e-09
Step 262/300
  Residual: 9.70e-09
Step 263/300
  Residual: 9.49e-09
Step 264/300
  Residual: 9.96e-09
Step 265/300
  Residual: 9.88e-09
Step 266/300
  Residual: 9.91e-09
Step 267/300
  Residual: 9.86e-09
Step 268/300
  Residual: 9.28e-09
Step 269/300
  Residual: 9.66e-09
Step 270/300
  Residual: 9.92e-09
Step 271/300
  Residual: 9.55e-09
Step 272/300
  Residual: 9.66e-09
Step 273/300
  Residual: 9.98e-09
Step 274/300
  Residual: 9.76e-09
Step 275/300
  Residual: 9.46e-09
Step 276/300
  Residual: 9.41e-09
Step 277/300
  Residual: 9.90e-09
Step 278/300
  Residual: 9.59e-09
Step 279/300
  Residual: 9.92e-09
Step 280/300
  Residual: 9.40e-09
Step 281/300
  Residual: 9.37e-09
Step 282/300
  Residual: 9.02e-09
Step 283/300
  Residual: 9.66e-09
Step 284/300
  Residual: 9.66e-09
Step 285/300
  Residual: 9.32e-09
Step 286/300
  Residual: 9.81e-09
Step 287/300
  Residual: 9.43e-09
Step 288/300
  Residual: 9.12e-09
Step 289/300
  Residual: 8.93e-09
Step 290/300
  Residual: 1.00e-08
Step 291/300
  Residual: 9.63e-09
Step 292/300
  Residual: 9.24e-09
Step 293/300
  Residual: 9.35e-09
Step 294/300
  Residual: 9.46e-09
Step 295/300
  Residual: 9.27e-09
Step 296/300
  Residual: 9.79e-09
Step 297/300
  Residual: 9.89e-09
Step 298/300
  Residual: 9.87e-09
Step 299/300
  Residual: 9.67e-09
Step 300/300
  Residual: 9.73e-09
</code></pre></div>
</details>
<div class="language-python highlight"><pre><span></span><code>
</code></pre></div>
<h2 id="visualization">Visualization<a class="headerlink" href="#visualization" title="Permanent link">¤</a></h2>
<p>Now we use <code>pyvista</code> and <code>matplotlib</code> to visualize the results.</p>
<details class="example">
<summary>PyVista code for visualization of the results</summary>
<div class="language-python highlight"><pre><span></span><code><span class="n">gradient_cohesive</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jacrev</span><span class="p">(</span><span class="n">total_cohesive_energy</span><span class="p">)</span>

<span class="n">cohesive_forces_per_step</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">opening_per_step</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">stresses_per_step</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">disp_per_step</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">150</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">170</span><span class="p">,</span> <span class="mi">175</span><span class="p">,</span> <span class="mi">180</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">190</span><span class="p">,</span> <span class="mi">200</span><span class="p">]:</span>
    <span class="n">cohesive_forces_per_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
        <span class="n">gradient_cohesive</span><span class="p">(</span><span class="n">u_per_step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_dofs</span><span class="p">),</span> <span class="n">delta_maxs_per_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">jump</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">u_per_step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">top_interface_nodes</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
        <span class="o">-</span> <span class="n">u_per_step</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">bottom_interface_nodes</span><span class="p">,</span> <span class="p">:]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="n">jump_quad</span> <span class="o">=</span> <span class="n">interface_op</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">jump</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">openings</span> <span class="o">=</span> <span class="n">compute_opening</span><span class="p">(</span><span class="n">jump_quad</span><span class="p">)</span>
    <span class="n">opening_per_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">openings</span><span class="p">)</span>

    <span class="n">grad_u</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u_per_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
    <span class="n">strains</span> <span class="o">=</span> <span class="n">compute_strain</span><span class="p">(</span><span class="n">grad_u</span><span class="p">)</span>
    <span class="n">stresses</span> <span class="o">=</span> <span class="n">compute_stress</span><span class="p">(</span><span class="n">strains</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="p">)</span>
    <span class="n">stresses_per_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stresses</span><span class="p">)</span>
    <span class="n">disp_per_step</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">u_per_step</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="n">sargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Stresses&quot;</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mf">0.08</span><span class="p">,</span>  <span class="c1"># Reduces the length (25% of window height)</span>
    <span class="n">width</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span>  <span class="c1"># Adjusts thickness</span>
    <span class="n">vertical</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>  <span class="c1"># Orientation</span>
    <span class="n">position_x</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span>  <span class="c1"># Distance from left edge (5%)</span>
    <span class="n">position_y</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>  <span class="c1"># Distance from bottom edge (5%)</span>
    <span class="n">title_font_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">label_font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span>  <span class="c1"># Useful for white/transparent backgrounds</span>
    <span class="n">font_family</span><span class="o">=</span><span class="s2">&quot;arial&quot;</span><span class="p">,</span>
<span class="p">)</span>


<span class="n">step_number</span> <span class="o">=</span> <span class="mi">6</span>


<span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">8</span><span class="p">),</span> <span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">HEXAHEDRON</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">grid</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s2">&quot;stresses&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stresses_per_step</span><span class="p">[</span><span class="n">step_number</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">E</span>
<span class="p">)</span>
<span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">cell_data_to_point_data</span><span class="p">()</span>

<span class="n">grid_interface</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">QUAD</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">grid_top_interface</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
        <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="p">)</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">QUAD</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">interface_mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">pl</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">window_size</span><span class="o">=</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">))</span>
<span class="n">grid</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">disp_per_step</span><span class="p">[</span><span class="n">step_number</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">))</span>
<span class="n">grid_interface</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="n">disp_per_step</span><span class="p">[</span><span class="n">step_number</span><span class="p">][</span><span class="n">bottom_interface_nodes</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">grid_interface</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s2">&quot;opening&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">opening_per_step</span><span class="p">[</span><span class="n">step_number</span><span class="p">])</span>
<span class="n">grid_interface</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="s2">&quot;opening&quot;</span><span class="p">)</span>

<span class="n">grid_top_interface</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
    <span class="n">disp_per_step</span><span class="p">[</span><span class="n">step_number</span><span class="p">][</span><span class="n">top_interface_nodes</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">grid_top_interface</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s2">&quot;opening&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">opening_per_step</span><span class="p">[</span><span class="n">step_number</span><span class="p">])</span>
<span class="n">grid_top_interface</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="s2">&quot;opening&quot;</span><span class="p">)</span>


<span class="n">warp_factor</span> <span class="o">=</span> <span class="mf">1.0</span>
<span class="n">warped</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">warp_by_vector</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">warp_factor</span><span class="p">)</span>

<span class="n">warped_interface</span> <span class="o">=</span> <span class="n">grid_interface</span><span class="o">.</span><span class="n">warp_by_vector</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">warp_factor</span> <span class="o">*</span> <span class="mf">0.98</span><span class="p">)</span>
<span class="n">warped_interface_top</span> <span class="o">=</span> <span class="n">grid_top_interface</span><span class="o">.</span><span class="n">warp_by_vector</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">warp_factor</span> <span class="o">*</span> <span class="mf">0.98</span><span class="p">)</span>


<span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
    <span class="n">warped_interface</span><span class="p">,</span>
    <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;pink_r&quot;</span><span class="p">,</span>
    <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;opening&quot;</span><span class="p">,</span>
    <span class="n">smooth_shading</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
    <span class="n">warped</span><span class="p">,</span>
    <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;stresses&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;managua_r&quot;</span><span class="p">,</span>
    <span class="n">line_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">scalar_bar_args</span><span class="o">=</span><span class="n">sargs</span><span class="p">,</span>
    <span class="n">opacity</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">view_vector</span><span class="p">([</span><span class="o">-</span><span class="mf">0.85</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</details>
<p><a href="../../assets/plots/cohesive_fracture_interactive.html" target="_blank"><img alt="Click to view interactive 3D model" src="../../assets/plots/cohesive_fracture_preview.png" /></a></p>
<p><em>Click the image above to explore the 3D fracture in full screen.</em></p>
<details class="example">
<summary>Plotting the force-displacement curve and energy evolution</summary>
<div class="language-python highlight"><pre><span></span><code><span class="n">Gamma_W</span> <span class="o">=</span> <span class="n">Gamma</span> <span class="o">*</span> <span class="p">(</span><span class="n">Lx</span> <span class="o">-</span> <span class="n">crack_length</span><span class="p">)</span> <span class="o">*</span> <span class="n">Lz</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span>
    <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">7</span><span class="p">,</span> <span class="mf">3.8</span><span class="p">),</span> <span class="n">layout</span><span class="o">=</span><span class="s2">&quot;constrained&quot;</span><span class="p">,</span> <span class="n">gridspec_kw</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;width_ratios&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]}</span>
<span class="p">)</span>


<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">displacement_on_top</span><span class="p">)</span> <span class="o">/</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="s2">&quot;elastic&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="s2">&quot;cohesive&quot;</span><span class="p">]))</span> <span class="o">/</span> <span class="n">Gamma_W</span><span class="p">,</span>
    <span class="n">markevery</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Total&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">displacement_on_top</span><span class="p">)</span> <span class="o">/</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="s2">&quot;elastic&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">Gamma_W</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Elastic&quot;</span><span class="p">,</span>
    <span class="n">markevery</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">displacement_on_top</span><span class="p">)</span> <span class="o">/</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">energies</span><span class="p">[</span><span class="s2">&quot;cohesive&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="n">Gamma_W</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Cohesive&quot;</span><span class="p">,</span>
    <span class="n">markevery</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\varepsilon$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\Psi/\Gamma\cdot</span><span class="si">{}</span><span class="s2">W$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">displacement_on_top</span><span class="p">)[</span><span class="o">-</span><span class="mi">80</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">markerscale</span><span class="o">=</span><span class="mf">1.25</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">displacement_on_top</span><span class="p">)</span> <span class="o">/</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">force_on_top</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sigma_c</span> <span class="o">*</span> <span class="n">Lz</span> <span class="o">*</span> <span class="p">(</span><span class="n">Lx</span> <span class="o">-</span> <span class="n">crack_length</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#AC8D18&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\varepsilon$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$F/(\sigma_c \cdot t \cdot W)$&quot;</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">displacement_on_top</span><span class="p">)[</span><span class="o">-</span><span class="mi">80</span><span class="p">]</span> <span class="o">/</span> <span class="n">height</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;top&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
<span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s2">&quot;right&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</details>
<p><img alt="img" src="../_data/cf4cc101e05041438cc3325308b16856.png" /></p>
<details class="example">
<summary>Create an animation of the fracture process</summary>
<div class="language-python highlight"><pre><span></span><code><span class="n">plotter</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">(</span><span class="n">notebook</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">off_screen</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">window_size</span> <span class="o">=</span> <span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">400</span><span class="p">)</span>

<span class="n">grid</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">disp_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
<span class="n">grid</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">stresses_per_step</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">E</span>
<span class="n">grid</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>

<span class="n">plotter</span><span class="o">.</span><span class="n">open_gif</span><span class="p">(</span><span class="s2">&quot;../assets/images/cohesive_fracture.gif&quot;</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span>
    <span class="n">grid</span><span class="p">,</span>
    <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;c&quot;</span><span class="p">,</span>
    <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;managua_r&quot;</span><span class="p">,</span>
    <span class="n">line_width</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
    <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plotter</span><span class="o">.</span><span class="n">view_vector</span><span class="p">([</span><span class="o">-</span><span class="mf">0.85</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>



<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">disp_per_step</span><span class="p">)):</span>
    <span class="n">u_current</span> <span class="o">=</span> <span class="n">disp_per_step</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
    <span class="n">values_current</span> <span class="o">=</span> <span class="n">stresses_per_step</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">u_current</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u_current</span><span class="p">)</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">cell_data</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">values_current</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">E</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">cell_data_to_point_data</span><span class="p">()</span>
    <span class="n">grid</span><span class="o">.</span><span class="n">set_active_scalars</span><span class="p">(</span><span class="s2">&quot;c&quot;</span><span class="p">)</span>

    <span class="n">plotter</span><span class="o">.</span><span class="n">update_scalar_bar_range</span><span class="p">(</span>
        <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">grid</span><span class="o">.</span><span class="n">point_data</span><span class="p">[</span><span class="s2">&quot;c&quot;</span><span class="p">])]</span>
    <span class="p">)</span>
    <span class="n">plotter</span><span class="o">.</span><span class="n">write_frame</span><span class="p">()</span>


<span class="n">plotter</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div>
</details>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 ETH Zurich (SMEC)
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "header-autohide", "announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.instant.preview", "navigation.path", "navigation.sections", "navigation.tabs.sticky", "search.highlight", "search.suggest", "content.footnote.tooltips"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/vtk.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
      
        <script src="../../javascripts/carousel.js"></script>
      
    
  </body>
</html>