
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The documentation for the tatva software package">
      
      
      
      
        <link rel="prev" href="../ncm_metamaterial/">
      
      
        <link rel="next" href="../../external_solvers/linear_elasticity_scipy/">
      
      
        
      
      
      <link rel="icon" href="../../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.2">
    
    
      
        <title>Neural Operator Element Method - tatva</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/custom_css.css">
    
      <link rel="stylesheet" href="../../stylesheets/mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css">
    
      <link rel="stylesheet" href="../../stylesheets/carousel.css">
    
      <link rel="stylesheet" href="../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#neural-operator-element-method" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="tatva" class="md-header__button md-logo" aria-label="tatva" data-md-component="logo">
      
  <img src="../../assets/favicon.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            tatva
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Neural Operator Element Method
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="black" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/smec-ethz/tatva" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    smec-ethz/tatva
  </div>
</a>
      </div>
    
  </nav>
  
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="tatva" class="md-nav__button md-logo" aria-label="tatva" data-md-component="logo">
      
  <img src="../../assets/favicon.png" alt="logo">

    </a>
    tatva
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/smec-ethz/tatva" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    smec-ethz/tatva
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Basics of tatva
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Basics of tatva
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../sparse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Building Stiffness Matrix
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../compound/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compound
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../lifter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lifter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../linear_elasticity/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Elasticity
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Multi-point Constraints
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Multi-point Constraints
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../nonlinear_hole_plate/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Rigid Body Constraints
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contact_3d/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Contact Mechanics
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../homogenization_periodic/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Periodic BCs (Lagrange Multipliers)
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_5" >
        
          
          <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Mixed-Dimensional Coupling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    Mixed-Dimensional Coupling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fracture_quasistatic_3d/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Cohesive Fracture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../soft_hydrogel/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Embedded 1D Fibres
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_6" >
        
          
          <label class="md-nav__link" for="__nav_3_6" id="__nav_3_6_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Multiphysics Coupling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_6">
            <span class="md-nav__icon md-icon"></span>
            
  
    Multiphysics Coupling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../thermal_shock_fracture/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Thermal-Shock Fracture
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../advection_diffusion_surface/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Non-Variational Formulations
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_8" checked>
        
          
          <label class="md-nav__link" for="__nav_3_8" id="__nav_3_8_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Data-Driven Modeling
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_8_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_8">
            <span class="md-nav__icon md-icon"></span>
            
  
    Data-Driven Modeling
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../ncm_metamaterial/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Constitutive Modeling
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Neural Operator Element Method
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Neural Operator Element Method
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mesh-and-material-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mesh and Material Setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-fem-energy-functional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining FEM energy functional
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-the-neural-constitutive-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining the Neural Constitutive Model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coupling-the-domains-through-energies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coupling the domains through energies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-coloring-to-compute-sparse-hessians" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Coloring to compute Sparse Hessians
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-boundary-conditions-and-loads" class="md-nav__link">
    <span class="md-ellipsis">
      
        Applying Boundary Conditions and Loads
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-newton-solver" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining Newton Solver
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solving-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solving the System
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Using External Solvers
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Using External Solvers
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external_solvers/linear_elasticity_scipy/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    SciPy
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_2" >
        
          
          <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    PETSc
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    PETSc
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external_solvers/linear_elasticity_petsc4py/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sparse Solver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../external_solvers/linear_elasticity_petsc4py_mf/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Matrix-Free Solver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    API reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            
  
    API reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.operator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Operator
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.mesh/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Mesh
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.element/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Element
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.sparse/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Sparse
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.compound/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Compound
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../api/tatva.lifter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Lifter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#mesh-and-material-setup" class="md-nav__link">
    <span class="md-ellipsis">
      
        Mesh and Material Setup
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-fem-energy-functional" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining FEM energy functional
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-the-neural-constitutive-model" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining the Neural Constitutive Model
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#coupling-the-domains-through-energies" class="md-nav__link">
    <span class="md-ellipsis">
      
        Coupling the domains through energies
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#using-coloring-to-compute-sparse-hessians" class="md-nav__link">
    <span class="md-ellipsis">
      
        Using Coloring to compute Sparse Hessians
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-boundary-conditions-and-loads" class="md-nav__link">
    <span class="md-ellipsis">
      
        Applying Boundary Conditions and Loads
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#defining-newton-solver" class="md-nav__link">
    <span class="md-ellipsis">
      
        Defining Newton Solver
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#solving-the-system" class="md-nav__link">
    <span class="md-ellipsis">
      
        Solving the System
      
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Getting Started
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../linear_elasticity/" class="md-path__link">
          
  <span class="md-ellipsis">
    Examples
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../ncm_metamaterial/" class="md-path__link">
          
  <span class="md-ellipsis">
    Data-Driven Modeling
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  



<p><a href="https://colab.research.google.com/github/smec-ethz/tatva-docs/blob/main/docs/examples/neural_operator_method_3d.ipynb" target="_blank"><img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/></a></p>
<h1 id="neural-operator-element-method">Neural Operator Element Method<a class="headerlink" href="#neural-operator-element-method" title="Permanent link">¤</a></h1>
<details class="example">
<summary>Colab Setup (Install Dependencies)</summary>
<div class="language-python highlight"><pre><span></span><code><span class="c1"># Only run this if we are in Google Colab</span>
<span class="k">if</span> <span class="s1">&#39;google.colab&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">get_ipython</span><span class="p">()):</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Installing dependencies from pyproject.toml...&quot;</span><span class="p">)</span>
    <span class="c1"># This installs the repo itself (and its dependencies)</span>
    <span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">gmsh</span> 
    <span class="err">!</span><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="o">-</span><span class="n">qq</span> <span class="n">xvfb</span> <span class="n">libgl1</span><span class="o">-</span><span class="n">mesa</span><span class="o">-</span><span class="n">glx</span>
    <span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="n">pyvista</span> <span class="o">-</span><span class="n">qq</span>
    <span class="err">!</span><span class="n">pip</span> <span class="n">install</span> <span class="o">-</span><span class="n">q</span> <span class="s2">&quot;git+https://github.com/smec-ethz/tatva-docs.git&quot;</span>

    <span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>

    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">jupyter_backend</span> <span class="o">=</span> <span class="s1">&#39;static&#39;</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">notebook</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">start_xvfb</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Installation complete!&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>
    <span class="n">pv</span><span class="o">.</span><span class="n">global_theme</span><span class="o">.</span><span class="n">jupyter_backend</span> <span class="o">=</span> <span class="s1">&#39;client&#39;</span>
</code></pre></div>
</details>
<p>In this notebook, we will implement a neural constitutive model. A neural constitutive model uses neural networks to represent the relationship between stress and strain in materials. This approach allows for more flexible and accurate modeling of complex material behaviors compared to traditional constitutive models.</p>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">jax</span>

<span class="n">jax</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="s2">&quot;jax_enable_x64&quot;</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>  <span class="c1"># Use double-precision for FEM stability</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">equinox</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">eqx</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.experimental.sparse</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jsp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pyvista</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pv</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">scipy.sparse</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">sp</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax</span><span class="w"> </span><span class="kn">import</span> <span class="n">Array</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">jax_autovmap</span><span class="w"> </span><span class="kn">import</span> <span class="n">autovmap</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tatva</span><span class="w"> </span><span class="kn">import</span> <span class="n">Mesh</span><span class="p">,</span> <span class="n">Operator</span><span class="p">,</span> <span class="n">element</span><span class="p">,</span> <span class="n">sparse</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">tatva_coloring</span><span class="w"> </span><span class="kn">import</span> <span class="n">distance2_color_and_seeds</span>
</code></pre></div>
<h2 id="mesh-and-material-setup">Mesh and Material Setup<a class="headerlink" href="#mesh-and-material-setup" title="Permanent link">¤</a></h2>
<p>We start by defining the mesh and material properties for our simulation.</p>
<details class="example">
<summary>Mesh Generation</summary>
<div class="language-python highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">gmsh</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">meshio</span>


<span class="k">def</span><span class="w"> </span><span class="nf">create_unstructured_3d_through_hole_mesh</span><span class="p">(</span>
    <span class="n">L</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">mesh_size</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;noem_3d_hole.msh&quot;</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates an unstructured tetrahedral mesh for a cuboid with a</span>
<span class="sd">    through-hole along the Z-axis.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - L: Width/Length of the cuboid (X and Y).</span>
<span class="sd">    - H: Height of the cuboid (Z-axis).</span>
<span class="sd">    - a: Side of the square hole.</span>
<span class="sd">    - mesh_size: Characteristic mesh size.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">initialize</span><span class="p">()</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="s2">&quot;NOEM_ThroughHole&quot;</span><span class="p">)</span>
    <span class="n">occ</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">occ</span>

    <span class="n">outer_vol</span> <span class="o">=</span> <span class="n">occ</span><span class="o">.</span><span class="n">addBox</span><span class="p">(</span><span class="o">-</span><span class="n">L</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">L</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">cutter_vol</span> <span class="o">=</span> <span class="n">occ</span><span class="o">.</span><span class="n">addBox</span><span class="p">(</span><span class="o">-</span><span class="n">a</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="n">a</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">H</span> <span class="o">+</span> <span class="mf">0.2</span><span class="p">)</span>

    <span class="n">fem_vol</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">occ</span><span class="o">.</span><span class="n">cut</span><span class="p">([(</span><span class="mi">3</span><span class="p">,</span> <span class="n">outer_vol</span><span class="p">)],</span> <span class="p">[(</span><span class="mi">3</span><span class="p">,</span> <span class="n">cutter_vol</span><span class="p">)])</span>
    <span class="n">occ</span><span class="o">.</span><span class="n">synchronize</span><span class="p">()</span>

    <span class="n">all_surfaces</span> <span class="o">=</span> <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">getEntities</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">interface_surfaces</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">for</span> <span class="n">dim</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">all_surfaces</span><span class="p">:</span>
        <span class="n">mass_prop</span> <span class="o">=</span> <span class="n">occ</span><span class="o">.</span><span class="n">getCenterOfMass</span><span class="p">(</span><span class="n">dim</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span>
        <span class="c1"># Check if surface is on the internal walls (x or y = +/- a/2)</span>
        <span class="n">is_internal_x</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mass_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">a</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mass_prop</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span>
        <span class="n">is_internal_y</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mass_prop</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">a</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
            <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mass_prop</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="n">a</span> <span class="o">/</span> <span class="mi">2</span>
        <span class="p">)</span>
        <span class="c1"># Ensure it&#39;s not the top or bottom cap of the cuboid</span>
        <span class="n">is_not_cap</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mass_prop</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span>
            <span class="n">mass_prop</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">H</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">1e-3</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">is_internal_x</span> <span class="ow">or</span> <span class="n">is_internal_y</span><span class="p">)</span> <span class="ow">and</span> <span class="n">is_not_cap</span><span class="p">:</span>
            <span class="n">interface_surfaces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>

    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="p">[</span><span class="n">fem_vol</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;FEM_Volume&quot;</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">addPhysicalGroup</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">interface_surfaces</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Interface&quot;</span><span class="p">)</span>

    <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.MeshSizeMin&quot;</span><span class="p">,</span> <span class="n">mesh_size</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">option</span><span class="o">.</span><span class="n">setNumber</span><span class="p">(</span><span class="s2">&quot;Mesh.MeshSizeMax&quot;</span><span class="p">,</span> <span class="n">mesh_size</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">mesh</span><span class="o">.</span><span class="n">generate</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">gmsh</span><span class="o">.</span><span class="n">finalize</span><span class="p">()</span>

    <span class="n">mesh</span> <span class="o">=</span> <span class="n">meshio</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
    <span class="n">nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">points</span>
    <span class="n">fem_elements</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells_dict</span><span class="p">[</span><span class="s2">&quot;tetra&quot;</span><span class="p">]</span>

    <span class="k">if</span> <span class="s2">&quot;Interface&quot;</span> <span class="ow">in</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cell_sets_dict</span><span class="p">:</span>
        <span class="c1"># Get the triangles forming the internal boundary</span>
        <span class="n">interface_tris</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">cells_dict</span><span class="p">[</span><span class="s2">&quot;triangle&quot;</span><span class="p">][</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">cell_sets_dict</span><span class="p">[</span><span class="s2">&quot;Interface&quot;</span><span class="p">][</span><span class="s2">&quot;triangle&quot;</span><span class="p">]</span>
        <span class="p">]</span>
        <span class="n">interface_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">interface_tris</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">interface_node_ids</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">cells_dict</span><span class="p">[</span><span class="s2">&quot;triangle&quot;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">nodes</span><span class="p">,</span> <span class="n">fem_elements</span><span class="p">,</span> <span class="n">interface_node_ids</span>


<span class="k">def</span><span class="w"> </span><span class="nf">get_pyvista_grid</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;quad&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">pv_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pv_points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">)</span>

    <span class="n">cell_type_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;quad&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;triangle&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span>
        <span class="s2">&quot;tetra&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>
        <span class="s2">&quot;hexahedron&quot;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">pv_cells</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
        <span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
                <span class="n">fill_value</span><span class="o">=</span><span class="n">cell_type_dict</span><span class="p">[</span><span class="n">cell_type</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">)</span>
            <span class="p">),</span>
            <span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">pv_cell_type_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;quad&quot;</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">QUAD</span><span class="p">,</span>
        <span class="s2">&quot;triangle&quot;</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">TRIANGLE</span><span class="p">,</span>
        <span class="s2">&quot;tetra&quot;</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">TETRA</span><span class="p">,</span>
        <span class="s2">&quot;hexahedron&quot;</span><span class="p">:</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">HEXAHEDRON</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">cell_types</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span>
        <span class="n">fill_value</span><span class="o">=</span><span class="n">pv_cell_type_dict</span><span class="p">[</span><span class="n">cell_type</span><span class="p">],</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],)</span>
    <span class="p">)</span>

    <span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span><span class="n">pv_cells</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">cell_types</span><span class="p">,</span> <span class="n">pv_points</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">grid</span>
</code></pre></div>
</details>
<div class="language-python highlight"><pre><span></span><code><span class="n">nodes</span><span class="p">,</span> <span class="n">elements</span><span class="p">,</span> <span class="n">interface_idx</span> <span class="o">=</span> <span class="n">create_unstructured_3d_through_hole_mesh</span><span class="p">(</span>
    <span class="n">L</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">H</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">mesh_size</span><span class="o">=</span><span class="mf">0.4</span>
<span class="p">)</span>

<span class="n">mesh</span> <span class="o">=</span> <span class="n">Mesh</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">nodes</span><span class="p">,</span> <span class="n">elements</span><span class="o">=</span><span class="n">elements</span><span class="p">)</span>

<span class="n">n_dofs_per_node</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_nodes</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">n_dofs</span> <span class="o">=</span> <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">n_nodes</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code><span class="n">grid</span> <span class="o">=</span> <span class="n">get_pyvista_grid</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">cell_type</span><span class="o">=</span><span class="s2">&quot;tetra&quot;</span><span class="p">)</span>
<span class="n">pl</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">grid</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p><img alt="FEM domain" src="../../assets/plots/noem_3d_hole_mesh.png" /></p>
<p>We define a simple 3D bar of length <span class="arithmatex">\(L\)</span>, width <span class="arithmatex">\(W\)</span>, and height <span class="arithmatex">\(H\)</span>. The bar isfixed at one end and subjected to a force at the other end. We use <code>Tetrahedral</code> elements for the mesh.</p>
<div class="language-python highlight"><pre><span></span><code><span class="n">tetra</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">Tetrahedron4</span><span class="p">()</span>
<span class="n">op</span> <span class="o">=</span> <span class="n">Operator</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">tetra</span><span class="p">)</span>

<span class="n">n_dofs_per_node</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs</span> <span class="o">=</span> <span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">n_dofs_per_node</span>
</code></pre></div>
<h2 id="defining-fem-energy-functional">Defining FEM energy functional<a class="headerlink" href="#defining-fem-energy-functional" title="Permanent link">¤</a></h2>
<div class="language-python highlight"><pre><span></span><code><span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">NamedTuple</span>


<span class="k">class</span><span class="w"> </span><span class="nc">Material</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Material properties for the elasticity operator.&quot;&quot;&quot;</span>

    <span class="n">mu</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Diffusion coefficient</span>
    <span class="n">lmbda</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Diffusion coefficient</span>


<span class="n">E</span> <span class="o">=</span> <span class="mf">1e4</span>
<span class="n">nu</span> <span class="o">=</span> <span class="mf">0.3</span>
<span class="n">mu</span> <span class="o">=</span> <span class="n">E</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span>
<span class="n">lmbda</span> <span class="o">=</span> <span class="n">E</span> <span class="o">*</span> <span class="n">nu</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">nu</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">nu</span><span class="p">)</span>

<span class="n">mat</span> <span class="o">=</span> <span class="n">Material</span><span class="p">(</span><span class="n">mu</span><span class="o">=</span><span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="o">=</span><span class="n">lmbda</span><span class="p">)</span>


<span class="nd">@autovmap</span><span class="p">(</span><span class="n">grad_u</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_strain</span><span class="p">(</span><span class="n">grad_u</span><span class="p">):</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">grad_u</span> <span class="o">+</span> <span class="n">grad_u</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>


<span class="nd">@autovmap</span><span class="p">(</span><span class="n">eps</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lmbda</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">compute_stress</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="p">):</span>
    <span class="n">I</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">eps</span> <span class="o">+</span> <span class="n">lmbda</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">trace</span><span class="p">(</span><span class="n">eps</span><span class="p">)</span> <span class="o">*</span> <span class="n">I</span>


<span class="nd">@autovmap</span><span class="p">(</span><span class="n">grad_u</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lmbda</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">strain_energy</span><span class="p">(</span><span class="n">grad_u</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="p">):</span>
    <span class="n">eps</span> <span class="o">=</span> <span class="n">compute_strain</span><span class="p">(</span><span class="n">grad_u</span><span class="p">)</span>
    <span class="n">sigma</span> <span class="o">=</span> <span class="n">compute_stress</span><span class="p">(</span><span class="n">eps</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">lmbda</span><span class="p">)</span>
    <span class="k">return</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s2">&quot;ij,ij-&gt;&quot;</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">eps</span><span class="p">)</span>


<span class="nd">@jax</span><span class="o">.</span><span class="n">jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">total_fem_energy</span><span class="p">(</span><span class="n">u_flat</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the total energy of the system.&quot;&quot;&quot;</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
    <span class="n">u_grad</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">energy_density</span> <span class="o">=</span> <span class="n">strain_energy</span><span class="p">(</span><span class="n">u_grad</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">lmbda</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">op</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">energy_density</span><span class="p">)</span>
</code></pre></div>
<h2 id="defining-the-neural-constitutive-model">Defining the Neural Constitutive Model<a class="headerlink" href="#defining-the-neural-constitutive-model" title="Permanent link">¤</a></h2>
<p>The specific architecture employed for the neural strain energy density was a feed-forward Multi-Layer Perceptron (MLP). The network consisted of an input layer accepting the two scalar invariants <span class="arithmatex">\((I_1, J)\)</span>, followed by two hidden layers with 16 neurons each, and a final output layer producing the scalar
energy value. To ensure that the second-order derivatives (Hessian) remained continuous and numerically stable, a \texttt{softplus} activation function was  utilized across all hidden layers. This choice is critical as standard piecewise linear activations, such as \texttt{ReLU}, yield zero second derivatives almost everywhere, leading to immediate solver divergence.</p>
<div class="arithmatex">\[
\psi_{\text{total}}(I_1, J) = \underbrace{\left[ \text{NN}(I_1, J; \theta) - \text{NN}(3, 1; \theta) \right]}_{\text{Shifted Neural Potential}} + \underbrace{\Psi_{\text{base}}(I_1, J)}_{\text{Stiffness Prior}}
\]</div>
<div class="language-python highlight"><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">NeuralInclusion</span><span class="p">(</span><span class="n">eqx</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="n">network</span><span class="p">:</span> <span class="n">eqx</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MLP</span>
    <span class="n">stiffness_prior</span><span class="p">:</span> <span class="nb">float</span>  <span class="c1"># Helps with initial convergence</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_interface_dofs</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">stiffness_prior</span><span class="o">=</span><span class="mf">1e-2</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_prior</span> <span class="o">=</span> <span class="n">stiffness_prior</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">network</span> <span class="o">=</span> <span class="n">eqx</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MLP</span><span class="p">(</span>
            <span class="n">in_size</span><span class="o">=</span><span class="n">n_interface_dofs</span><span class="p">,</span>
            <span class="n">out_size</span><span class="o">=</span><span class="s2">&quot;scalar&quot;</span><span class="p">,</span>
            <span class="n">width_size</span><span class="o">=</span><span class="mi">64</span><span class="p">,</span>
            <span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
            <span class="n">activation</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">softplus</span><span class="p">,</span>  <span class="c1"># Must be smooth for Hessian</span>
            <span class="n">key</span><span class="o">=</span><span class="n">key</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">u_interface</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the shifted energy: G(u) - G(0) + prior</span>
<span class="sd">        u_interface: flattened array of displacements for nodes on the boundary</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">psi_raw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">(</span><span class="n">u_interface</span><span class="p">)</span>

        <span class="n">u_zero</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">u_interface</span><span class="p">)</span>
        <span class="n">psi_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">network</span><span class="p">(</span><span class="n">u_zero</span><span class="p">)</span>

        <span class="n">prior</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">stiffness_prior</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">u_interface</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

        <span class="k">return</span> <span class="p">(</span><span class="n">psi_raw</span> <span class="o">-</span> <span class="n">psi_0</span><span class="p">)</span> <span class="o">+</span> <span class="n">prior</span>


<span class="n">neural_operator</span> <span class="o">=</span> <span class="n">NeuralInclusion</span><span class="p">(</span>
    <span class="n">n_interface_dofs</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">interface_idx</span><span class="p">)</span> <span class="o">*</span> <span class="n">n_dofs_per_node</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="n">jax</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">PRNGKey</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>
    <span class="n">stiffness_prior</span><span class="o">=</span><span class="mf">1e4</span><span class="p">,</span> <span class="c1">#1e-2</span>
<span class="p">)</span>
</code></pre></div>
<h2 id="coupling-the-domains-through-energies">Coupling the domains through energies<a class="headerlink" href="#coupling-the-domains-through-energies" title="Permanent link">¤</a></h2>
<p>Now, we define the neural network architecture and the total strain energy density function based on the neural network defined above.</p>
<div class="language-python highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">total_energy</span><span class="p">(</span><span class="n">u_flat</span><span class="p">,</span> <span class="n">neural_operator</span><span class="p">):</span>
    <span class="n">u</span> <span class="o">=</span> <span class="n">u_flat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
    <span class="n">energy_fem</span> <span class="o">=</span> <span class="n">total_fem_energy</span><span class="p">(</span><span class="n">u_flat</span><span class="p">)</span>

    <span class="c1"># Extract displacements for interface nodes</span>
    <span class="n">u_interface</span> <span class="o">=</span> <span class="n">u</span><span class="p">[</span><span class="n">interface_idx</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">energy_neural</span> <span class="o">=</span> <span class="n">neural_operator</span><span class="p">(</span><span class="n">u_interface</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">energy_fem</span> <span class="o">+</span> <span class="n">energy_neural</span>
</code></pre></div>
<h2 id="using-coloring-to-compute-sparse-hessians">Using Coloring to compute Sparse Hessians<a class="headerlink" href="#using-coloring-to-compute-sparse-hessians" title="Permanent link">¤</a></h2>
<div class="language-python highlight"><pre><span></span><code><span class="n">sparsity_pattern</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">create_sparsity_pattern</span><span class="p">(</span><span class="n">mesh</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="o">=</span><span class="n">n_dofs_per_node</span><span class="p">)</span>
<span class="n">sparsity_pattern_csr</span> <span class="o">=</span> <span class="n">sp</span><span class="o">.</span><span class="n">csr_matrix</span><span class="p">(</span>
    <span class="p">(</span>
        <span class="n">sparsity_pattern</span><span class="o">.</span><span class="n">data</span><span class="p">,</span>
        <span class="p">(</span><span class="n">sparsity_pattern</span><span class="o">.</span><span class="n">indices</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">sparsity_pattern</span><span class="o">.</span><span class="n">indices</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span>
    <span class="p">)</span>
<span class="p">)</span>
<span class="n">indptr</span> <span class="o">=</span> <span class="n">sparsity_pattern_csr</span><span class="o">.</span><span class="n">indptr</span>
<span class="n">indices</span> <span class="o">=</span> <span class="n">sparsity_pattern_csr</span><span class="o">.</span><span class="n">indices</span>
<span class="n">colors</span> <span class="o">=</span> <span class="n">distance2_color_and_seeds</span><span class="p">(</span>
    <span class="n">row_ptr</span><span class="o">=</span><span class="n">sparsity_pattern_csr</span><span class="o">.</span><span class="n">indptr</span><span class="p">,</span>
    <span class="n">col_idx</span><span class="o">=</span><span class="n">sparsity_pattern_csr</span><span class="o">.</span><span class="n">indices</span><span class="p">,</span>
    <span class="n">n_dofs</span><span class="o">=</span><span class="n">n_dofs</span><span class="p">,</span>
<span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Closure for the energy based on the NN weights</span>
<span class="n">energy_fn</span> <span class="o">=</span> <span class="n">eqx</span><span class="o">.</span><span class="n">Partial</span><span class="p">(</span><span class="n">total_energy</span><span class="p">,</span> <span class="n">neural_operator</span><span class="o">=</span><span class="n">neural_operator</span><span class="p">)</span>
<span class="n">gradient_fn</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">jacrev</span><span class="p">(</span><span class="n">energy_fn</span><span class="p">)</span>

<span class="n">K_sparse_fn</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">jacfwd</span><span class="p">(</span>
    <span class="n">gradient</span><span class="o">=</span><span class="n">gradient_fn</span><span class="p">,</span>
    <span class="n">row_ptr</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sparsity_pattern_csr</span><span class="o">.</span><span class="n">indptr</span><span class="p">),</span>
    <span class="n">col_indices</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">sparsity_pattern_csr</span><span class="o">.</span><span class="n">indices</span><span class="p">),</span>
    <span class="n">colors</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">colors</span><span class="p">),</span>
    <span class="n">color_batch_size</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<span class="p">)</span>
</code></pre></div>
<p>To check if the total energy at 0 deformation is zero, we can evaluate the total strain energy density function at the reference configuration where <span class="arithmatex">\(I_1 = 3\)</span> and <span class="arithmatex">\(J = 1\)</span>. This ensures that the neural network's contribution is shifted  appropriately, and the stiffness prior is also evaluated at this point.</p>
<h2 id="applying-boundary-conditions-and-loads">Applying Boundary Conditions and Loads<a class="headerlink" href="#applying-boundary-conditions-and-loads" title="Permanent link">¤</a></h2>
<div class="language-python highlight"><pre><span></span><code><span class="c1"># Boundary Conditions &amp; Solver Setup</span>
<span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]),</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">])</span>


<span class="n">top_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_max</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">bottom_nodes</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y_min</span><span class="p">))[</span><span class="mi">0</span><span class="p">]</span>

<span class="n">applied_dofs</span> <span class="o">=</span> <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">top_nodes</span> <span class="o">+</span> <span class="mi">1</span>  <span class="c1"># y-direction DOFs at the top nodes</span>

<span class="n">zero_dofs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span>
    <span class="p">[</span><span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">bottom_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span> <span class="o">*</span> <span class="n">bottom_nodes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">fixed_dofs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">applied_dofs</span><span class="p">,</span> <span class="n">zero_dofs</span><span class="p">])</span>

<span class="n">prescribed_values</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_dofs</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">applied_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>

<span class="n">zero_indices</span><span class="p">,</span> <span class="n">one_indices</span> <span class="o">=</span> <span class="n">sparse</span><span class="o">.</span><span class="n">get_bc_indices</span><span class="p">(</span><span class="n">sparsity_pattern</span><span class="p">,</span> <span class="n">fixed_dofs</span><span class="p">)</span>
</code></pre></div>
<h2 id="defining-newton-solver">Defining Newton Solver<a class="headerlink" href="#defining-newton-solver" title="Permanent link">¤</a></h2>
<details class="example">
<summary>Newton Solver with Sparse Hessian</summary>
<div class="language-python highlight"><pre><span></span><code><span class="nd">@eqx</span><span class="o">.</span><span class="n">filter_jit</span>
<span class="k">def</span><span class="w"> </span><span class="nf">newton_sparse_solver</span><span class="p">(</span>
    <span class="n">u</span><span class="p">,</span>
    <span class="n">fext</span><span class="p">,</span>
    <span class="n">gradient</span><span class="p">,</span>
    <span class="n">hessian_sparse</span><span class="p">,</span>
    <span class="n">fixed_dofs</span><span class="p">,</span>
    <span class="n">zero_indices</span><span class="p">,</span>
    <span class="n">one_indices</span><span class="p">,</span>
    <span class="n">indptr</span><span class="p">,</span>
    <span class="n">indices</span><span class="p">,</span>
<span class="p">):</span>
    <span class="n">fint</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>

    <span class="n">norm_res</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="n">tol</span> <span class="o">=</span> <span class="mf">1e-8</span>
    <span class="n">max_iter</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">solver</span><span class="p">(</span><span class="n">u</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">def</span><span class="w"> </span><span class="nf">true_func</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
            <span class="n">fint</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">residual</span> <span class="o">=</span> <span class="n">fext</span> <span class="o">-</span> <span class="n">fint</span>
            <span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>

            <span class="n">K_sparse</span> <span class="o">=</span> <span class="n">hessian_sparse</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
            <span class="n">K_data_lifted</span> <span class="o">=</span> <span class="n">K_sparse</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">zero_indices</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">K_data_lifted</span> <span class="o">=</span> <span class="n">K_data_lifted</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">one_indices</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

            <span class="n">du</span> <span class="o">=</span> <span class="n">jsp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">spsolve</span><span class="p">(</span>
                <span class="n">K_data_lifted</span><span class="p">,</span> <span class="n">indices</span><span class="o">=</span><span class="n">indices</span><span class="p">,</span> <span class="n">indptr</span><span class="o">=</span><span class="n">indptr</span><span class="p">,</span> <span class="n">b</span><span class="o">=</span><span class="n">residual</span>
            <span class="p">)</span>

            <span class="n">u</span> <span class="o">=</span> <span class="n">u</span><span class="o">.</span><span class="n">at</span><span class="p">[:]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">du</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">u</span>

        <span class="k">def</span><span class="w"> </span><span class="nf">false_func</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">u</span>

        <span class="n">fint</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">fext</span> <span class="o">-</span> <span class="n">fint</span>
        <span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">norm_res</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span>

        <span class="n">jax</span><span class="o">.</span><span class="n">debug</span><span class="o">.</span><span class="n">print</span><span class="p">(</span><span class="s2">&quot;residual=</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">norm_res</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">norm_res</span> <span class="o">&gt;</span> <span class="n">tol</span><span class="p">,</span> <span class="n">true_func</span><span class="p">,</span> <span class="n">false_func</span><span class="p">,</span> <span class="n">u</span><span class="p">),</span> <span class="n">n</span>

    <span class="n">u</span><span class="p">,</span> <span class="n">xs</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span><span class="n">solver</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">u</span><span class="p">,</span> <span class="n">xs</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_iter</span><span class="p">))</span>

    <span class="n">fint</span> <span class="o">=</span> <span class="n">gradient</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">fext</span> <span class="o">-</span> <span class="n">fint</span>
    <span class="n">residual</span> <span class="o">=</span> <span class="n">residual</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">norm_res</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">residual</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">u</span><span class="p">,</span> <span class="n">norm_res</span>
</code></pre></div>
</details>
<h2 id="solving-the-system">Solving the System<a class="headerlink" href="#solving-the-system" title="Permanent link">¤</a></h2>
<div class="language-python highlight"><pre><span></span><code><span class="n">fext</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n_dofs</span><span class="p">)</span> 

<span class="n">n_steps</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">applied_displacement</span> <span class="o">=</span> <span class="n">prescribed_values</span> <span class="o">/</span> <span class="n">n_steps</span>  <span class="c1"># displacement increment</span>

<span class="n">residual_history</span> <span class="o">=</span> <span class="p">[]</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Neural Constitutive Solver...&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_steps</span><span class="p">):</span>  <span class="c1"># Newton iterations</span>
    <span class="n">u_prev</span> <span class="o">=</span> <span class="n">u_prev</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">applied_displacement</span><span class="p">[</span><span class="n">fixed_dofs</span><span class="p">])</span>

    <span class="n">u_new</span><span class="p">,</span> <span class="n">rnorm</span> <span class="o">=</span> <span class="n">newton_sparse_solver</span><span class="p">(</span>
        <span class="n">u_prev</span><span class="p">,</span>
        <span class="n">fext</span><span class="p">,</span>
        <span class="n">gradient_fn</span><span class="p">,</span>
        <span class="n">K_sparse_fn</span><span class="p">,</span>
        <span class="n">fixed_dofs</span><span class="p">,</span>
        <span class="n">zero_indices</span><span class="p">,</span>
        <span class="n">one_indices</span><span class="p">,</span>
        <span class="n">indptr</span><span class="p">,</span>
        <span class="n">indices</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">residual_history</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rnorm</span><span class="p">)</span>

    <span class="n">u_prev</span> <span class="o">=</span> <span class="n">u_new</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">: Residual Norm = </span><span class="si">{</span><span class="n">rnorm</span><span class="si">:</span><span class="s2">.4e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="n">u_sol</span> <span class="o">=</span> <span class="n">u_prev</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">n_nodes</span><span class="p">,</span> <span class="n">n_dofs_per_node</span><span class="p">)</span>
</code></pre></div>
<div class="language-python highlight"><pre><span></span><code>
</code></pre></div>
<details class="example">
<summary>Visualization of Results</summary>
<div class="language-python highlight"><pre><span></span><code><span class="n">grid</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">UnstructuredGrid</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">((</span><span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">),</span> <span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">elements</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pv</span><span class="o">.</span><span class="n">CellType</span><span class="o">.</span><span class="n">TETRA</span><span class="p">),</span>
    <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mesh</span><span class="o">.</span><span class="n">coords</span><span class="p">),</span>
<span class="p">)</span>

<span class="n">pl</span> <span class="o">=</span> <span class="n">pv</span><span class="o">.</span><span class="n">Plotter</span><span class="p">()</span>

<span class="n">grad_u</span> <span class="o">=</span> <span class="n">op</span><span class="o">.</span><span class="n">grad</span><span class="p">(</span><span class="n">u_sol</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
<span class="n">strains</span> <span class="o">=</span> <span class="n">compute_strain</span><span class="p">(</span><span class="n">grad_u</span><span class="p">)</span>
<span class="n">stresses</span> <span class="o">=</span> <span class="n">compute_stress</span><span class="p">(</span><span class="n">strains</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">mu</span><span class="p">,</span> <span class="n">mat</span><span class="o">.</span><span class="n">lmbda</span><span class="p">)</span>


<span class="n">grid</span><span class="p">[</span><span class="s2">&quot;u&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">u_sol</span><span class="p">)</span>
<span class="n">grid</span><span class="p">[</span><span class="s2">&quot;sigma_yy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stresses</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">warped</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">warp_by_vector</span><span class="p">(</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">4.0</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">add_mesh</span><span class="p">(</span><span class="n">warped</span><span class="p">,</span> <span class="n">show_edges</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">scalars</span><span class="o">=</span><span class="s2">&quot;u&quot;</span><span class="p">,</span> <span class="n">component</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;managua&quot;</span><span class="p">,</span> <span class="n">show_scalar_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">view_isometric</span><span class="p">()</span>
<span class="n">pl</span><span class="o">.</span><span class="n">screenshot</span><span class="p">(</span><span class="s2">&quot;../assets/plots/neural_soft_inclusion_deformed_mesh.png&quot;</span><span class="p">,</span> <span class="n">transparent_background</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pl</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
</details>
<p><img alt="Neural operator element with soft inclusion" src="../../assets/plots/neural_soft_inclusion_deformed_mesh.png" /></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2026 ETH Zurich (SMEC)
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../..", "features": ["navigation.sections", "header-autohide", "announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.instant.preview", "navigation.path", "navigation.sections", "navigation.tabs.sticky", "search.highlight", "search.suggest", "content.footnote.tooltips"], "search": "../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
        <script src="https://unpkg.com/vtk.js"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
      
        <script src="../../javascripts/carousel.js"></script>
      
    
  </body>
</html>